var wasm,heap,heap_next,cachedTextDecoder,cachedUint8Memory0,WASM_VECTOR_LEN,cachedTextEncoder,encodeString,cachedInt32Memory0,CLOSURE_DTORS,cachedFloat32Memory0,cachedUint32Memory0,CreateSessionOptionsFinalization,CreateSessionOptions,IncrDomDocClientFinalization,IncrDomDocClient,PageInfoFinalization,PageInfo2,PagesInfoFinalization,PagesInfo,RenderPageImageOptionsFinalization,RenderPageImageOptions,RenderSessionFinalization,RenderSession,RenderSessionOptionsFinalization,RenderSessionOptions,TypstRendererFinalization,TypstRenderer,TypstRendererBuilderFinalization,TypstRendererBuilder,typst_ts_renderer_default,importWasmModule,__defProp=Object.defineProperty,__getOwnPropNames=Object.getOwnPropertyNames,__esm=(e,t)=>function(){return e&&(t=(0,e[__getOwnPropNames(e)[0]])(e=0)),t},__export=(e,t)=>{for(var r in t)__defProp(e,r,{get:t[r],enumerable:!0})};function getObject(e){return heap[e]}function dropObject(e){e<132||(heap[e]=heap_next,heap_next=e)}function takeObject(e){const t=getObject(e);return dropObject(e),t}function getUint8Memory0(){return null!==cachedUint8Memory0&&0!==cachedUint8Memory0.byteLength||(cachedUint8Memory0=new Uint8Array(wasm.memory.buffer)),cachedUint8Memory0}function getStringFromWasm0(e,t){return e>>>=0,cachedTextDecoder.decode(getUint8Memory0().subarray(e,e+t))}function addHeapObject(e){heap_next===heap.length&&heap.push(heap.length+1);const t=heap_next;if("number"!=typeof(heap_next=heap[t]))throw new Error("corrupt heap");return heap[t]=e,t}function _assertBoolean(e){if("boolean"!=typeof e)throw new Error("expected a boolean argument, found "+typeof e)}function passStringToWasm0(e,t,r){if("string"!=typeof e)throw new Error("expected a string argument, found "+typeof e);if(void 0===r){const r=cachedTextEncoder.encode(e),n=t(r.length,1)>>>0;return getUint8Memory0().subarray(n,n+r.length).set(r),WASM_VECTOR_LEN=r.length,n}let n=e.length,o=t(n,1)>>>0;const i=getUint8Memory0();let s=0;for(;s<n;s++){const t=e.charCodeAt(s);if(t>127)break;i[o+s]=t}if(s!==n){0!==s&&(e=e.slice(s)),o=r(o,n,n=s+3*e.length,1)>>>0;const t=getUint8Memory0().subarray(o+s,o+n),i=encodeString(e,t);if(i.read!==e.length)throw new Error("failed to pass whole string");s+=i.written,o=r(o,n,s,1)>>>0}return WASM_VECTOR_LEN=s,o}function isLikeNone(e){return null==e}function getInt32Memory0(){return null!==cachedInt32Memory0&&0!==cachedInt32Memory0.byteLength||(cachedInt32Memory0=new Int32Array(wasm.memory.buffer)),cachedInt32Memory0}function debugString(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=debugString(e[0]));for(let n=1;n<t;n++)r+=", "+debugString(e[n]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let n;if(!(r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}function makeMutClosure(e,t,r,n){const o={a:e,b:t,cnt:1,dtor:r},i=(...e)=>{o.cnt++;const t=o.a;o.a=0;try{return n(t,o.b,...e)}finally{0==--o.cnt?(wasm.__wbindgen_export_2.get(o.dtor)(t,o.b),CLOSURE_DTORS.unregister(o)):o.a=t}};return i.original=o,CLOSURE_DTORS.register(i,o,o),i}function logError(e,t){try{return e.apply(this,t)}catch(e){let t=function(){try{return e instanceof Error?`${e.message}\n\nStack:\n${e.stack}`:e.toString()}catch(e){return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",t),e}}function _assertNum(e){if("number"!=typeof e)throw new Error("expected a number argument, found "+typeof e)}function __wbg_adapter_24(e,t,r){_assertNum(e),_assertNum(t),wasm.__wbindgen_export_3(e,t,addHeapObject(r))}function makeClosure(e,t,r,n){const o={a:e,b:t,cnt:1,dtor:r},i=(...e)=>{o.cnt++;try{return n(o.a,o.b,...e)}finally{0==--o.cnt&&(wasm.__wbindgen_export_2.get(o.dtor)(o.a,o.b),o.a=0,CLOSURE_DTORS.unregister(o))}};return i.original=o,CLOSURE_DTORS.register(i,o,o),i}function __wbg_adapter_27(e,t){_assertNum(e),_assertNum(t),wasm.__wbindgen_export_4(e,t)}function __wbg_adapter_30(e,t,r){_assertNum(e),_assertNum(t),wasm.__wbindgen_export_5(e,t,addHeapObject(r))}function renderer_build_info(){return takeObject(wasm.renderer_build_info())}function _assertClass(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`);return e.ptr}function passArray8ToWasm0(e,t){const r=t(1*e.length,1)>>>0;return getUint8Memory0().set(e,r/1),WASM_VECTOR_LEN=e.length,r}function handleError(e,t){try{return e.apply(this,t)}catch(e){wasm.__wbindgen_export_7(addHeapObject(e))}}function __wbg_adapter_76(e,t,r,n){_assertNum(e),_assertNum(t),wasm.__wbindgen_export_8(e,t,addHeapObject(r),addHeapObject(n))}function getFloat32Memory0(){return null!==cachedFloat32Memory0&&0!==cachedFloat32Memory0.byteLength||(cachedFloat32Memory0=new Float32Array(wasm.memory.buffer)),cachedFloat32Memory0}function getUint32Memory0(){return null!==cachedUint32Memory0&&0!==cachedUint32Memory0.byteLength||(cachedUint32Memory0=new Uint32Array(wasm.memory.buffer)),cachedUint32Memory0}function passArray32ToWasm0(e,t){const r=t(4*e.length,4)>>>0;return getUint32Memory0().set(e,r/4),WASM_VECTOR_LEN=e.length,r}async function __wbg_load(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}function __wbg_get_imports(){const e={wbg:{}};return e.wbg.__wbg_new_81740750da40724f=function(){return logError((function(e,t){try{var r={a:e,b:t};return addHeapObject(new Promise(((e,t)=>{const n=r.a;r.a=0;try{return __wbg_adapter_76(n,r.b,e,t)}finally{r.a=n}})))}finally{r.a=r.b=0}}),arguments)},e.wbg.__wbindgen_object_drop_ref=function(e){takeObject(e)},e.wbg.__wbg_new_72fb9a18b5ae2624=function(){return logError((function(){return addHeapObject(new Object)}),arguments)},e.wbg.__wbindgen_string_new=function(e,t){return addHeapObject(getStringFromWasm0(e,t))},e.wbg.__wbg_set_1f9b04f170055d33=function(){return handleError((function(e,t,r){const n=Reflect.set(getObject(e),getObject(t),getObject(r));return _assertBoolean(n),n}),arguments)},e.wbg.__wbg_new_16b304a2cfa7ff4a=function(){return logError((function(){return addHeapObject(new Array)}),arguments)},e.wbg.__wbg_push_a5b05aedc7234f9f=function(){return logError((function(e,t){const r=getObject(e).push(getObject(t));return _assertNum(r),r}),arguments)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){return logError((function(){return addHeapObject(new Error)}),arguments)},e.wbg.__wbg_stack_658279fe44541cf6=function(){return logError((function(e,t){const r=passStringToWasm0(getObject(t).stack,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),n=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=n,getInt32Memory0()[e/4+0]=r}),arguments)},e.wbg.__wbg_error_f851667af71bcfc6=function(){return logError((function(e,t){let r,n;try{r=e,n=t,console.error(getStringFromWasm0(e,t))}finally{wasm.__wbindgen_export_6(r,n,1)}}),arguments)},e.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return handleError((function(){return addHeapObject(self.self)}),arguments)},e.wbg.__wbg_window_c6fb939a7f436783=function(){return handleError((function(){return addHeapObject(window.window)}),arguments)},e.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return handleError((function(){return addHeapObject(globalThis.globalThis)}),arguments)},e.wbg.__wbg_global_207b558942527489=function(){return handleError((function(){return addHeapObject(global.global)}),arguments)},e.wbg.__wbindgen_is_undefined=function(e){const t=void 0===getObject(e);return _assertBoolean(t),t},e.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(){return logError((function(e,t){return addHeapObject(new Function(getStringFromWasm0(e,t)))}),arguments)},e.wbg.__wbg_call_27c0f87801dedf93=function(){return handleError((function(e,t){return addHeapObject(getObject(e).call(getObject(t)))}),arguments)},e.wbg.__wbg_new_28c511d9baebfa89=function(){return logError((function(e,t){return addHeapObject(new Error(getStringFromWasm0(e,t)))}),arguments)},e.wbg.__wbg_getAttribute_99bddb29274b29b9=function(){return logError((function(e,t,r,n){const o=getObject(t).getAttribute(getStringFromWasm0(r,n));var i=isLikeNone(o)?0:passStringToWasm0(o,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),s=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=s,getInt32Memory0()[e/4+0]=i}),arguments)},e.wbg.__wbg_newwithlength_e9b4878cebadb3d3=function(){return logError((function(e){return addHeapObject(new Uint8Array(e>>>0))}),arguments)},e.wbg.__wbg_length_c20a40f15020d68a=function(){return logError((function(e){const t=getObject(e).length;return _assertNum(t),t}),arguments)},e.wbg.__wbindgen_memory=function(){return addHeapObject(wasm.memory)},e.wbg.__wbg_buffer_12d079cc21e14bdb=function(){return logError((function(e){return addHeapObject(getObject(e).buffer)}),arguments)},e.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(){return logError((function(e,t,r){return addHeapObject(new Uint8Array(getObject(e),t>>>0,r>>>0))}),arguments)},e.wbg.__wbg_set_a47bac70306a19a7=function(){return logError((function(e,t,r){getObject(e).set(getObject(t),r>>>0)}),arguments)},e.wbg.__wbg_newwithu8arraysequenceandoptions_366f462e1b363808=function(){return handleError((function(e,t){return addHeapObject(new Blob(getObject(e),getObject(t)))}),arguments)},e.wbg.__wbg_createObjectURL_ad8244759309f204=function(){return handleError((function(e,t){const r=passStringToWasm0(URL.createObjectURL(getObject(t)),wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),n=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=n,getInt32Memory0()[e/4+0]=r}),arguments)},e.wbg.__wbg_then_a73caa9a87991566=function(){return logError((function(e,t,r){return addHeapObject(getObject(e).then(getObject(t),getObject(r)))}),arguments)},e.wbg.__wbindgen_cb_drop=function(e){const t=takeObject(e).original;if(1==t.cnt--)return t.a=0,!0;const r=!1;return _assertBoolean(r),r},e.wbg.__wbg_setAttribute_3c9f6c303b696daa=function(){return handleError((function(e,t,r,n,o){getObject(e).setAttribute(getStringFromWasm0(t,r),getStringFromWasm0(n,o))}),arguments)},e.wbg.__wbindgen_object_clone_ref=function(e){return addHeapObject(getObject(e))},e.wbg.__wbg_setsrc_681ceacdf6845f60=function(){return logError((function(e,t,r){getObject(e).src=getStringFromWasm0(t,r)}),arguments)},e.wbg.__wbg_setonload_4b2d1fd60416c2dd=function(){return logError((function(e,t){getObject(e).onload=getObject(t)}),arguments)},e.wbg.__wbg_setonerror_4e3faee320602b64=function(){return logError((function(e,t){getObject(e).onerror=getObject(t)}),arguments)},e.wbg.__wbg_restore_b0b630dcf5875c16=function(){return logError((function(e){getObject(e).restore()}),arguments)},e.wbg.__wbg_save_b2ec4f4afd250d50=function(){return logError((function(e){getObject(e).save()}),arguments)},e.wbg.__wbg_setTransform_73631293eb78bf95=function(){return handleError((function(e,t,r,n,o,i,s){getObject(e).setTransform(t,r,n,o,i,s)}),arguments)},e.wbg.__wbg_setfillStyle_4de94b275f5761f2=function(){return logError((function(e,t){getObject(e).fillStyle=getObject(t)}),arguments)},e.wbg.__wbg_newwithpathstring_eaf93999895560bf=function(){return handleError((function(e,t){return addHeapObject(new Path2D(getStringFromWasm0(e,t)))}),arguments)},e.wbg.__wbg_fill_2a41be87d81e2fc6=function(){return logError((function(e,t){getObject(e).fill(getObject(t))}),arguments)},e.wbg.__wbg_drawImage_14f72ed9b8430e9d=function(){return handleError((function(e,t,r,n,o,i){getObject(e).drawImage(getObject(t),r,n,o,i)}),arguments)},e.wbg.__wbg_setlineCap_561c8efd4e48949c=function(){return logError((function(e,t,r){getObject(e).lineCap=getStringFromWasm0(t,r)}),arguments)},e.wbg.__wbg_setlineJoin_c2f314b5744d240f=function(){return logError((function(e,t,r){getObject(e).lineJoin=getStringFromWasm0(t,r)}),arguments)},e.wbg.__wbg_setmiterLimit_d1ca0274cb45b371=function(){return logError((function(e,t){getObject(e).miterLimit=t}),arguments)},e.wbg.__wbg_setlineDashOffset_ee14f664955fb961=function(){return logError((function(e,t){getObject(e).lineDashOffset=t}),arguments)},e.wbg.__wbindgen_number_new=function(e){return addHeapObject(e)},e.wbg.__wbg_setLineDash_aed2919a1550112b=function(){return handleError((function(e,t){getObject(e).setLineDash(getObject(t))}),arguments)},e.wbg.__wbg_setlineWidth_ea4c8cb72d8cdc31=function(){return logError((function(e,t){getObject(e).lineWidth=t}),arguments)},e.wbg.__wbg_setstrokeStyle_c79ba6bc36a7f302=function(){return logError((function(e,t){getObject(e).strokeStyle=getObject(t)}),arguments)},e.wbg.__wbg_stroke_98acc75a72e3ec2a=function(){return logError((function(e,t){getObject(e).stroke(getObject(t))}),arguments)},e.wbg.__wbg_clip_2164a4dde3544fc7=function(){return logError((function(e,t){getObject(e).clip(getObject(t))}),arguments)},e.wbg.__wbg_revokeObjectURL_16a2051ee9d99da9=function(){return handleError((function(e,t){URL.revokeObjectURL(getStringFromWasm0(e,t))}),arguments)},e.wbg.__wbg_get_e3c254076557e348=function(){return handleError((function(e,t){return addHeapObject(Reflect.get(getObject(e),getObject(t)))}),arguments)},e.wbg.__wbg_stringify_8887fe74e1c50d81=function(){return handleError((function(e){return addHeapObject(JSON.stringify(getObject(e)))}),arguments)},e.wbg.__wbg_log_5bb5f88f245d7762=function(){return logError((function(e){console.log(getObject(e))}),arguments)},e.wbg.__wbindgen_string_get=function(e,t){const r=getObject(t),n="string"==typeof r?r:void 0;var o=isLikeNone(n)?0:passStringToWasm0(n,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),i=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=i,getInt32Memory0()[e/4+0]=o},e.wbg.__wbg_instanceof_Window_f401953a2cf86220=function(){return logError((function(e){let t;try{t=getObject(e)instanceof Window}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbg_document_5100775d18896c16=function(){return logError((function(e){const t=getObject(e).document;return isLikeNone(t)?0:addHeapObject(t)}),arguments)},e.wbg.__wbg_createElement_8bae7856a4bb7411=function(){return handleError((function(e,t,r){return addHeapObject(getObject(e).createElement(getStringFromWasm0(t,r)))}),arguments)},e.wbg.__wbg_instanceof_HtmlImageElement_d823b10f99854a6b=function(){return logError((function(e){let t;try{t=getObject(e)instanceof HTMLImageElement}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbg_log_1746d5c75ec89963=function(){return logError((function(e,t){console.log(getObject(e),getObject(t))}),arguments)},e.wbg.__wbg_replaceWith_72e597a5990af8e0=function(){return handleError((function(e,t){getObject(e).replaceWith(getObject(t))}),arguments)},e.wbg.__wbg_cloneNode_e19c313ea20d5d1d=function(){return handleError((function(e){return addHeapObject(getObject(e).cloneNode())}),arguments)},e.wbg.__wbg_instanceof_Element_6945fc210db80ea9=function(){return logError((function(e){let t;try{t=getObject(e)instanceof Element}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbg_firstElementChild_c78596cd0c9b16a7=function(){return logError((function(e){const t=getObject(e).firstElementChild;return isLikeNone(t)?0:addHeapObject(t)}),arguments)},e.wbg.__wbg_instanceof_SvgGraphicsElement_a5b95d5bb634faf8=function(){return logError((function(e){let t;try{t=getObject(e)instanceof SVGGraphicsElement}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbg_nextElementSibling_72304aeb66624976=function(){return logError((function(e){const t=getObject(e).nextElementSibling;return isLikeNone(t)?0:addHeapObject(t)}),arguments)},e.wbg.__wbg_lastElementChild_d408eaa043927a37=function(){return logError((function(e){const t=getObject(e).lastElementChild;return isLikeNone(t)?0:addHeapObject(t)}),arguments)},e.wbg.__wbg_remove_49b0a5925a04b955=function(){return logError((function(e){getObject(e).remove()}),arguments)},e.wbg.__wbg_instanceof_HtmlCanvasElement_46bdbf323b0b18d1=function(){return logError((function(e){let t;try{t=getObject(e)instanceof HTMLCanvasElement}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbg_instanceof_HtmlTemplateElement_e8ad7d7a7fc9abc2=function(){return logError((function(e){let t;try{t=getObject(e)instanceof HTMLTemplateElement}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbindgen_is_function=function(e){const t="function"==typeof getObject(e);return _assertBoolean(t),t},e.wbg.__wbg_style_c3fc3dd146182a2d=function(){return logError((function(e){return addHeapObject(getObject(e).style)}),arguments)},e.wbg.__wbg_setProperty_ea7d15a2b591aa97=function(){return handleError((function(e,t,r,n,o){getObject(e).setProperty(getStringFromWasm0(t,r),getStringFromWasm0(n,o))}),arguments)},e.wbg.__wbg_setwidth_080107476e633963=function(){return logError((function(e,t){getObject(e).width=t>>>0}),arguments)},e.wbg.__wbg_setheight_dc240617639f1f51=function(){return logError((function(e,t){getObject(e).height=t>>>0}),arguments)},e.wbg.__wbg_setinnerHTML_26d69b59e1af99c7=function(){return logError((function(e,t,r){getObject(e).innerHTML=getStringFromWasm0(t,r)}),arguments)},e.wbg.__wbg_call_8e7cb608789c2528=function(){return handleError((function(e,t,r,n){return addHeapObject(getObject(e).call(getObject(t),getObject(r),getObject(n)))}),arguments)},e.wbg.__wbg_getContext_df50fa48a8876636=function(){return handleError((function(e,t,r){const n=getObject(e).getContext(getStringFromWasm0(t,r));return isLikeNone(n)?0:addHeapObject(n)}),arguments)},e.wbg.__wbg_instanceof_CanvasRenderingContext2d_20bf99ccc051643b=function(){return logError((function(e){let t;try{t=getObject(e)instanceof CanvasRenderingContext2D}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbg_clearRect_05de681275dda635=function(){return logError((function(e,t,r,n,o){getObject(e).clearRect(t,r,n,o)}),arguments)},e.wbg.__wbg_removeProperty_fa6d48e2923dcfac=function(){return handleError((function(e,t,r,n){const o=passStringToWasm0(getObject(t).removeProperty(getStringFromWasm0(r,n)),wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),i=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=i,getInt32Memory0()[e/4+0]=o}),arguments)},e.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return handleError((function(e,t,r){return addHeapObject(getObject(e).call(getObject(t),getObject(r)))}),arguments)},e.wbg.__wbg_content_e05939f111e5ff5a=function(){return logError((function(e){return addHeapObject(getObject(e).content)}),arguments)},e.wbg.__wbg_firstElementChild_92c5a0bbdcb24796=function(){return logError((function(e){const t=getObject(e).firstElementChild;return isLikeNone(t)?0:addHeapObject(t)}),arguments)},e.wbg.__wbg_instanceof_SvgsvgElement_ab645292b5c30322=function(){return logError((function(e){let t;try{t=getObject(e)instanceof SVGSVGElement}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbg_instanceof_HtmlDivElement_31d3273633f69d96=function(){return logError((function(e){let t;try{t=getObject(e)instanceof HTMLDivElement}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbg_call_938992c832f74314=function(){return handleError((function(e,t,r,n,o){return addHeapObject(getObject(e).call(getObject(t),getObject(r),getObject(n),getObject(o)))}),arguments)},e.wbg.__wbg_appendChild_580ccb11a660db68=function(){return handleError((function(e,t){return addHeapObject(getObject(e).appendChild(getObject(t)))}),arguments)},e.wbg.__wbg_instanceof_HtmlElement_3bcc4ff70cfdcba5=function(){return logError((function(e){let t;try{t=getObject(e)instanceof HTMLElement}catch(e){t=!1}const r=t;return _assertBoolean(r),r}),arguments)},e.wbg.__wbg_setfont_a4d031cf2c94b4db=function(){return logError((function(e,t,r){getObject(e).font=getStringFromWasm0(t,r)}),arguments)},e.wbg.__wbg_measureText_ea212ea07011bf71=function(){return handleError((function(e,t,r){return addHeapObject(getObject(e).measureText(getStringFromWasm0(t,r)))}),arguments)},e.wbg.__wbg_width_e870de808b523851=function(){return logError((function(e){return getObject(e).width}),arguments)},e.wbg.__wbg_incrdomdocclient_new=function(){return logError((function(e){return addHeapObject(IncrDomDocClient.__wrap(e))}),arguments)},e.wbg.__wbg_set_d4638f722068f043=function(){return logError((function(e,t,r){getObject(e)[t>>>0]=takeObject(r)}),arguments)},e.wbg.__wbg_fillRect_b5c8166281bac9df=function(){return logError((function(e,t,r,n,o){getObject(e).fillRect(t,r,n,o)}),arguments)},e.wbg.__wbg_typstrenderer_new=function(){return logError((function(e){return addHeapObject(TypstRenderer.__wrap(e))}),arguments)},e.wbg.__wbg_warn_63bbae1730aead09=function(){return logError((function(e){console.warn(getObject(e))}),arguments)},e.wbg.__wbg_new_63b92bc8671ed464=function(){return logError((function(e){return addHeapObject(new Uint8Array(getObject(e)))}),arguments)},e.wbg.__wbg_clientWidth_7ea3915573b64350=function(){return logError((function(e){const t=getObject(e).clientWidth;return _assertNum(t),t}),arguments)},e.wbg.__wbindgen_debug_string=function(e,t){const r=passStringToWasm0(debugString(getObject(t)),wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),n=WASM_VECTOR_LEN;getInt32Memory0()[e/4+1]=n,getInt32Memory0()[e/4+0]=r},e.wbg.__wbindgen_throw=function(e,t){throw new Error(getStringFromWasm0(e,t))},e.wbg.__wbg_queueMicrotask_3cbae2ec6b6cd3d6=function(){return logError((function(e){return addHeapObject(getObject(e).queueMicrotask)}),arguments)},e.wbg.__wbg_resolve_b0083a7967828ec8=function(){return logError((function(e){return addHeapObject(Promise.resolve(getObject(e)))}),arguments)},e.wbg.__wbg_then_0c86a60e8fcfe9f6=function(){return logError((function(e,t){return addHeapObject(getObject(e).then(getObject(t)))}),arguments)},e.wbg.__wbg_queueMicrotask_481971b0d87f3dd4=function(){return logError((function(e){queueMicrotask(getObject(e))}),arguments)},e.wbg.__wbindgen_closure_wrapper1529=function(){return logError((function(e,t,r){return addHeapObject(makeMutClosure(e,t,196,__wbg_adapter_24))}),arguments)},e.wbg.__wbindgen_closure_wrapper1533=function(){return logError((function(e,t,r){return addHeapObject(makeClosure(e,t,196,__wbg_adapter_27))}),arguments)},e.wbg.__wbindgen_closure_wrapper1534=function(){return logError((function(e,t,r){return addHeapObject(makeClosure(e,t,196,__wbg_adapter_30))}),arguments)},e}function __wbg_init_memory(e,t){}function __wbg_finalize_init(e,t){return wasm=e.exports,__wbg_init.__wbindgen_wasm_module=t,cachedFloat32Memory0=null,cachedInt32Memory0=null,cachedUint32Memory0=null,cachedUint8Memory0=null,wasm}function initSync(e){if(void 0!==wasm)return wasm;const t=__wbg_get_imports();return __wbg_init_memory(t),e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e)),__wbg_finalize_init(new WebAssembly.Instance(e,t),e)}async function __wbg_init(e){if(void 0!==wasm)return wasm;void 0===e&&(e=importWasmModule("typst_ts_renderer_bg.wasm",import.meta.url));const t=__wbg_get_imports();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e)),__wbg_init_memory(t);const{instance:r,module:n}=await __wbg_load(await e,t);return __wbg_finalize_init(r,n)}function setImportWasmModule(e){importWasmModule=e}var wasm_pack_shim_default,nodeJsImportWasmModule,isNode,init_typst_ts_renderer=__esm({"../renderer/pkg/typst_ts_renderer.mjs"(){(heap=new Array(128).fill(void 0)).push(void 0,null,!0,!1),heap_next=heap.length,cachedTextDecoder="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}},"undefined"!=typeof TextDecoder&&cachedTextDecoder.decode(),cachedUint8Memory0=null,WASM_VECTOR_LEN=0,cachedTextEncoder="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},encodeString="function"==typeof cachedTextEncoder.encodeInto?function(e,t){return cachedTextEncoder.encodeInto(e,t)}:function(e,t){const r=cachedTextEncoder.encode(e);return t.set(r),{read:e.length,written:r.length}},cachedInt32Memory0=null,CLOSURE_DTORS="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>{wasm.__wbindgen_export_2.get(e.dtor)(e.a,e.b)})),cachedFloat32Memory0=null,cachedUint32Memory0=null,CreateSessionOptionsFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm.__wbg_createsessionoptions_free(e>>>0))),CreateSessionOptions=class{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,CreateSessionOptionsFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_createsessionoptions_free(e)}constructor(){const e=wasm.createsessionoptions_new();return this.__wbg_ptr=e>>>0,this}set format(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr);const t=passStringToWasm0(e,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),r=WASM_VECTOR_LEN;wasm.createsessionoptions_set_format(this.__wbg_ptr,t,r)}set artifact_content(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr);const t=passArray8ToWasm0(e,wasm.__wbindgen_export_0),r=WASM_VECTOR_LEN;wasm.createsessionoptions_set_artifact_content(this.__wbg_ptr,t,r)}},IncrDomDocClientFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm.__wbg_incrdomdocclient_free(e>>>0))),IncrDomDocClient=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e>>>=0;const t=Object.create(IncrDomDocClient.prototype);return t.__wbg_ptr=e,IncrDomDocClientFinalization.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,IncrDomDocClientFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_incrdomdocclient_free(e)}bind_functions(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr),wasm.incrdomdocclient_bind_functions(this.__wbg_ptr,addHeapObject(e))}relayout(e,t,r,n){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),takeObject(wasm.incrdomdocclient_relayout(this.__wbg_ptr,e,t,r,n))}need_repaint(e,t,r,n,o,i){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const _=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),_assertNum(e),_assertNum(i),wasm.incrdomdocclient_need_repaint(_,this.__wbg_ptr,e,t,r,n,o,i);var s=getInt32Memory0()[_/4+0],a=getInt32Memory0()[_/4+1];if(getInt32Memory0()[_/4+2])throw takeObject(a);return 0!==s}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}repaint(e,t,r,n,o,i){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const _=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),_assertNum(e),_assertNum(i),wasm.incrdomdocclient_repaint(_,this.__wbg_ptr,e,t,r,n,o,i);var s=getInt32Memory0()[_/4+0],a=getInt32Memory0()[_/4+1];if(getInt32Memory0()[_/4+2])throw takeObject(a);return takeObject(s)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}},PageInfoFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm.__wbg_pageinfo_free(e>>>0))),PageInfo2=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e>>>=0;const t=Object.create(PageInfo2.prototype);return t.__wbg_ptr=e,PageInfoFinalization.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,PageInfoFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_pageinfo_free(e)}get page_off(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),wasm.pageinfo_page_off(this.__wbg_ptr)>>>0}get width_pt(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),wasm.pageinfo_width_pt(this.__wbg_ptr)}get height_pt(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),wasm.pageinfo_height_pt(this.__wbg_ptr)}},PagesInfoFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm.__wbg_pagesinfo_free(e>>>0))),PagesInfo=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e>>>=0;const t=Object.create(PagesInfo.prototype);return t.__wbg_ptr=e,PagesInfoFinalization.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,PagesInfoFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_pagesinfo_free(e)}get page_count(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),wasm.pagesinfo_page_count(this.__wbg_ptr)>>>0}page_by_number(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr),_assertNum(e);const t=wasm.pagesinfo_page_by_number(this.__wbg_ptr,e);return 0===t?void 0:PageInfo2.__wrap(t)}page(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr),_assertNum(e);const t=wasm.pagesinfo_page(this.__wbg_ptr,e);return PageInfo2.__wrap(t)}width(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),wasm.pagesinfo_width(this.__wbg_ptr)}height(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),wasm.pagesinfo_height(this.__wbg_ptr)}},RenderPageImageOptionsFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm.__wbg_renderpageimageoptions_free(e>>>0))),RenderPageImageOptions=class{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,RenderPageImageOptionsFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_renderpageimageoptions_free(e)}constructor(){const e=wasm.renderpageimageoptions_new();return this.__wbg_ptr=e>>>0,this}get page_off(){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.renderpageimageoptions_page_off(r,this.__wbg_ptr);var e=getInt32Memory0()[r/4+0],t=getInt32Memory0()[r/4+1];return 0===e?void 0:t>>>0}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}set page_off(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr),isLikeNone(e)||_assertNum(e),wasm.renderpageimageoptions_set_page_off(this.__wbg_ptr,!isLikeNone(e),isLikeNone(e)?0:e)}get cache_key(){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.renderpageimageoptions_cache_key(r,this.__wbg_ptr);var e=getInt32Memory0()[r/4+0],t=getInt32Memory0()[r/4+1];let n;return 0!==e&&(n=getStringFromWasm0(e,t).slice(),wasm.__wbindgen_export_6(e,1*t,1)),n}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}set cache_key(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr);var t=isLikeNone(e)?0:passStringToWasm0(e,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),r=WASM_VECTOR_LEN;wasm.renderpageimageoptions_set_cache_key(this.__wbg_ptr,t,r)}get data_selection(){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.renderpageimageoptions_data_selection(r,this.__wbg_ptr);var e=getInt32Memory0()[r/4+0],t=getInt32Memory0()[r/4+1];return 0===e?void 0:t>>>0}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}set data_selection(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr),isLikeNone(e)||_assertNum(e),wasm.renderpageimageoptions_set_data_selection(this.__wbg_ptr,!isLikeNone(e),isLikeNone(e)?0:e)}},RenderSessionFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm.__wbg_rendersession_free(e>>>0))),RenderSession=class{constructor(){throw new Error("cannot invoke `new` directly")}static __wrap(e){e>>>=0;const t=Object.create(RenderSession.prototype);return t.__wbg_ptr=e,RenderSessionFinalization.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,RenderSessionFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_rendersession_free(e)}render_in_window(e,t,r,n){let o,i;try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const _=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.rendersession_render_in_window(_,this.__wbg_ptr,e,t,r,n);var s=getInt32Memory0()[_/4+0],a=getInt32Memory0()[_/4+1];return o=s,i=a,getStringFromWasm0(s,a)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_export_6(o,i,1)}}get pixel_per_pt(){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.rendersession_pixel_per_pt(r,this.__wbg_ptr);var e=getInt32Memory0()[r/4+0],t=getFloat32Memory0()[r/4+1];return 0===e?void 0:t}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}set pixel_per_pt(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr),wasm.rendersession_set_pixel_per_pt(this.__wbg_ptr,e)}get background_color(){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.rendersession_background_color(r,this.__wbg_ptr);var e=getInt32Memory0()[r/4+0],t=getInt32Memory0()[r/4+1];let n;return 0!==e&&(n=getStringFromWasm0(e,t).slice(),wasm.__wbindgen_export_6(e,1*t,1)),n}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr);const t=passStringToWasm0(e,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),r=WASM_VECTOR_LEN;wasm.rendersession_set_background_color(this.__wbg_ptr,t,r)}get pages_info(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr);const e=wasm.rendersession_pages_info(this.__wbg_ptr);return PagesInfo.__wrap(e)}get doc_width(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),wasm.rendersession_doc_width(this.__wbg_ptr)}get doc_height(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),wasm.rendersession_doc_height(this.__wbg_ptr)}source_span(e){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const o=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr);const i=passArray32ToWasm0(e,wasm.__wbindgen_export_0),s=WASM_VECTOR_LEN;wasm.rendersession_source_span(o,this.__wbg_ptr,i,s);var t=getInt32Memory0()[o/4+0],r=getInt32Memory0()[o/4+1],n=getInt32Memory0()[o/4+2];if(getInt32Memory0()[o/4+3])throw takeObject(n);let a;return 0!==t&&(a=getStringFromWasm0(t,r).slice(),wasm.__wbindgen_export_6(t,1*r,1)),a}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}},RenderSessionOptionsFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm.__wbg_rendersessionoptions_free(e>>>0))),RenderSessionOptions=class{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,RenderSessionOptionsFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_rendersessionoptions_free(e)}constructor(){const e=wasm.rendersessionoptions_new();return this.__wbg_ptr=e>>>0,this}get pixel_per_pt(){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.rendersession_pixel_per_pt(r,this.__wbg_ptr);var e=getInt32Memory0()[r/4+0],t=getFloat32Memory0()[r/4+1];return 0===e?void 0:t}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}set pixel_per_pt(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr),wasm.rendersession_set_pixel_per_pt(this.__wbg_ptr,e)}get background_color(){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.rendersessionoptions_background_color(r,this.__wbg_ptr);var e=getInt32Memory0()[r/4+0],t=getInt32Memory0()[r/4+1];let n;return 0!==e&&(n=getStringFromWasm0(e,t).slice(),wasm.__wbindgen_export_6(e,1*t,1)),n}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}set background_color(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr);const t=passStringToWasm0(e,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),r=WASM_VECTOR_LEN;wasm.rendersessionoptions_set_background_color(this.__wbg_ptr,t,r)}get format(){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.rendersession_background_color(r,this.__wbg_ptr);var e=getInt32Memory0()[r/4+0],t=getInt32Memory0()[r/4+1];let n;return 0!==e&&(n=getStringFromWasm0(e,t).slice(),wasm.__wbindgen_export_6(e,1*t,1)),n}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}set format(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");_assertNum(this.__wbg_ptr);const t=passStringToWasm0(e,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),r=WASM_VECTOR_LEN;wasm.rendersession_set_background_color(this.__wbg_ptr,t,r)}},TypstRendererFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm.__wbg_typstrenderer_free(e>>>0))),TypstRenderer=class{static __wrap(e){e>>>=0;const t=Object.create(TypstRenderer.prototype);return t.__wbg_ptr=e,TypstRendererFinalization.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,TypstRendererFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_typstrenderer_free(e)}load_glyph_pack(e){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr),wasm.typstrenderer_load_glyph_pack(r,this.__wbg_ptr,addHeapObject(e));var t=getInt32Memory0()[r/4+0];if(getInt32Memory0()[r/4+1])throw takeObject(t)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}constructor(){const e=wasm.typstrenderer_new();return this.__wbg_ptr=e>>>0,this}create_session(e){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const n=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr);let o=0;if(!isLikeNone(e)){if(_assertClass(e,CreateSessionOptions),0===e.__wbg_ptr)throw new Error("Attempt to use a moved value");o=e.__destroy_into_raw()}wasm.typstrenderer_create_session(n,this.__wbg_ptr,o);var t=getInt32Memory0()[n/4+0],r=getInt32Memory0()[n/4+1];if(getInt32Memory0()[n/4+2])throw takeObject(r);return RenderSession.__wrap(t)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}reset(e){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const r=wasm.__wbindgen_add_to_stack_pointer(-16);if(_assertNum(this.__wbg_ptr),_assertClass(e,RenderSession),0===e.__wbg_ptr)throw new Error("Attempt to use a moved value");wasm.typstrenderer_reset(r,this.__wbg_ptr,e.__wbg_ptr);var t=getInt32Memory0()[r/4+0];if(getInt32Memory0()[r/4+1])throw takeObject(t)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}manipulate_data(e,t,r){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const o=wasm.__wbindgen_add_to_stack_pointer(-16);if(_assertNum(this.__wbg_ptr),_assertClass(e,RenderSession),0===e.__wbg_ptr)throw new Error("Attempt to use a moved value");const i=passStringToWasm0(t,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),s=WASM_VECTOR_LEN,a=passArray8ToWasm0(r,wasm.__wbindgen_export_0),_=WASM_VECTOR_LEN;wasm.typstrenderer_manipulate_data(o,this.__wbg_ptr,e.__wbg_ptr,i,s,a,_);var n=getInt32Memory0()[o/4+0];if(getInt32Memory0()[o/4+1])throw takeObject(n)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}session_from_artifact(e,t){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const o=wasm.__wbindgen_add_to_stack_pointer(-16);_assertNum(this.__wbg_ptr);const i=passArray8ToWasm0(e,wasm.__wbindgen_export_0),s=WASM_VECTOR_LEN,a=passStringToWasm0(t,wasm.__wbindgen_export_0,wasm.__wbindgen_export_1),_=WASM_VECTOR_LEN;wasm.typstrenderer_session_from_artifact(o,this.__wbg_ptr,i,s,a,_);var r=getInt32Memory0()[o/4+0],n=getInt32Memory0()[o/4+1];if(getInt32Memory0()[o/4+2])throw takeObject(n);return RenderSession.__wrap(r)}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}render_page_to_canvas(e,t,r){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");if(_assertNum(this.__wbg_ptr),_assertClass(e,RenderSession),0===e.__wbg_ptr)throw new Error("Attempt to use a moved value");let n=0;if(!isLikeNone(r)){if(_assertClass(r,RenderPageImageOptions),0===r.__wbg_ptr)throw new Error("Attempt to use a moved value");n=r.__destroy_into_raw()}return takeObject(wasm.typstrenderer_render_page_to_canvas(this.__wbg_ptr,e.__wbg_ptr,isLikeNone(t)?0:addHeapObject(t),n))}render_svg_diff(e,t,r,n,o){let i,s;try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const c=wasm.__wbindgen_add_to_stack_pointer(-16);if(_assertNum(this.__wbg_ptr),_assertClass(e,RenderSession),0===e.__wbg_ptr)throw new Error("Attempt to use a moved value");wasm.typstrenderer_render_svg_diff(c,this.__wbg_ptr,e.__wbg_ptr,t,r,n,o);var a=getInt32Memory0()[c/4+0],_=getInt32Memory0()[c/4+1];return i=a,s=_,getStringFromWasm0(a,_)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_export_6(i,s,1)}}svg_data(e,t){let r,n;try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const d=wasm.__wbindgen_add_to_stack_pointer(-16);if(_assertNum(this.__wbg_ptr),_assertClass(e,RenderSession),0===e.__wbg_ptr)throw new Error("Attempt to use a moved value");isLikeNone(t)||_assertNum(t),wasm.typstrenderer_svg_data(d,this.__wbg_ptr,e.__wbg_ptr,!isLikeNone(t),isLikeNone(t)?0:t);var o=getInt32Memory0()[d/4+0],i=getInt32Memory0()[d/4+1],s=getInt32Memory0()[d/4+2],a=getInt32Memory0()[d/4+3],_=o,c=i;if(a)throw _=0,c=0,takeObject(s);return r=_,n=c,getStringFromWasm0(_,c)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_export_6(r,n,1)}}get_customs(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");if(_assertNum(this.__wbg_ptr),_assertClass(e,RenderSession),0===e.__wbg_ptr)throw new Error("Attempt to use a moved value");return takeObject(wasm.typstrenderer_get_customs(this.__wbg_ptr,e.__wbg_ptr))}render_svg(e,t){try{if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const o=wasm.__wbindgen_add_to_stack_pointer(-16);if(_assertNum(this.__wbg_ptr),_assertClass(e,RenderSession),0===e.__wbg_ptr)throw new Error("Attempt to use a moved value");wasm.typstrenderer_render_svg(o,this.__wbg_ptr,e.__wbg_ptr,addHeapObject(t));var r=getInt32Memory0()[o/4+0],n=getInt32Memory0()[o/4+1];if(getInt32Memory0()[o/4+2])throw takeObject(n);return 0!==r}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}mount_dom(e,t){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");if(_assertNum(this.__wbg_ptr),_assertClass(e,RenderSession),0===e.__wbg_ptr)throw new Error("Attempt to use a moved value");return takeObject(wasm.typstrenderer_mount_dom(this.__wbg_ptr,e.__wbg_ptr,addHeapObject(t)))}},TypstRendererBuilderFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm.__wbg_typstrendererbuilder_free(e>>>0))),TypstRendererBuilder=class{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,TypstRendererBuilderFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm.__wbg_typstrendererbuilder_free(e)}add_glyph_pack(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),takeObject(wasm.typstrendererbuilder_add_glyph_pack(this.__wbg_ptr,addHeapObject(e)))}add_raw_font(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),takeObject(wasm.typstrendererbuilder_add_raw_font(this.__wbg_ptr,addHeapObject(e)))}add_web_fonts(e){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");return _assertNum(this.__wbg_ptr),takeObject(wasm.typstrendererbuilder_add_web_fonts(this.__wbg_ptr,addHeapObject(e)))}constructor(){try{const r=wasm.__wbindgen_add_to_stack_pointer(-16);wasm.typstrendererbuilder_new(r);var e=getInt32Memory0()[r/4+0],t=getInt32Memory0()[r/4+1];if(getInt32Memory0()[r/4+2])throw takeObject(t);return this.__wbg_ptr=e>>>0,this}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}build(){if(0==this.__wbg_ptr)throw new Error("Attempt to use a moved value");const e=this.__destroy_into_raw();return _assertNum(e),takeObject(wasm.typstrendererbuilder_build(e))}},typst_ts_renderer_default=__wbg_init,importWasmModule=async function(e,t){throw new Error("Cannot import wasm module without importer: "+e+" "+t)}}}),wasm_pack_shim_exports={};__export(wasm_pack_shim_exports,{CreateSessionOptions:()=>CreateSessionOptions,IncrDomDocClient:()=>IncrDomDocClient,PageInfo:()=>PageInfo2,PagesInfo:()=>PagesInfo,RenderPageImageOptions:()=>RenderPageImageOptions,RenderSession:()=>RenderSession,RenderSessionOptions:()=>RenderSessionOptions,TypstRenderer:()=>TypstRenderer,TypstRendererBuilder:()=>TypstRendererBuilder,default:()=>wasm_pack_shim_default,initSync:()=>initSync,renderer_build_info:()=>renderer_build_info,setImportWasmModule:()=>setImportWasmModule});var wasm2,heap2,heap_next2,cachedTextDecoder2,cachedUint8Memory02,WASM_VECTOR_LEN2,cachedTextEncoder2,encodeString2,cachedInt32Memory02,cachedFloat64Memory0,cachedBigInt64Memory0,CLOSURE_DTORS2,cachedUint32Memory02,IncrServerFinalization,IncrServer,ProxyContextFinalization,ProxyContext,TypstCompilerFinalization,TypstCompiler,TypstCompilerBuilderFinalization,TypstCompilerBuilder,typst_ts_web_compiler_default,importWasmModule2,init_wasm_pack_shim=__esm({"../renderer/pkg/wasm-pack-shim.mjs"(){init_typst_ts_renderer(),init_typst_ts_renderer(),init_typst_ts_renderer(),wasm_pack_shim_default=typst_ts_renderer_default,nodeJsImportWasmModule=async function(e,t){const r=new Function("m","return import(m)"),n=await r("path"),{readFileSync:o}=await r("fs"),i=new URL(n.join(n.dirname(t),e));return await o(i).buffer},(isNode="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node)&&setImportWasmModule(nodeJsImportWasmModule)}});function getObject2(e){return heap2[e]}function dropObject2(e){e<132||(heap2[e]=heap_next2,heap_next2=e)}function takeObject2(e){const t=getObject2(e);return dropObject2(e),t}function addHeapObject2(e){heap_next2===heap2.length&&heap2.push(heap2.length+1);const t=heap_next2;return heap_next2=heap2[t],heap2[t]=e,t}function getUint8Memory02(){return null!==cachedUint8Memory02&&0!==cachedUint8Memory02.byteLength||(cachedUint8Memory02=new Uint8Array(wasm2.memory.buffer)),cachedUint8Memory02}function getStringFromWasm02(e,t){return e>>>=0,cachedTextDecoder2.decode(getUint8Memory02().subarray(e,e+t))}function passStringToWasm02(e,t,r){if(void 0===r){const r=cachedTextEncoder2.encode(e),n=t(r.length,1)>>>0;return getUint8Memory02().subarray(n,n+r.length).set(r),WASM_VECTOR_LEN2=r.length,n}let n=e.length,o=t(n,1)>>>0;const i=getUint8Memory02();let s=0;for(;s<n;s++){const t=e.charCodeAt(s);if(t>127)break;i[o+s]=t}if(s!==n){0!==s&&(e=e.slice(s)),o=r(o,n,n=s+3*e.length,1)>>>0;const t=getUint8Memory02().subarray(o+s,o+n);s+=encodeString2(e,t).written,o=r(o,n,s,1)>>>0}return WASM_VECTOR_LEN2=s,o}function isLikeNone2(e){return null==e}function getInt32Memory02(){return null!==cachedInt32Memory02&&0!==cachedInt32Memory02.byteLength||(cachedInt32Memory02=new Int32Array(wasm2.memory.buffer)),cachedInt32Memory02}function getFloat64Memory0(){return null!==cachedFloat64Memory0&&0!==cachedFloat64Memory0.byteLength||(cachedFloat64Memory0=new Float64Array(wasm2.memory.buffer)),cachedFloat64Memory0}function getBigInt64Memory0(){return null!==cachedBigInt64Memory0&&0!==cachedBigInt64Memory0.byteLength||(cachedBigInt64Memory0=new BigInt64Array(wasm2.memory.buffer)),cachedBigInt64Memory0}function debugString2(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=debugString2(e[0]));for(let n=1;n<t;n++)r+=", "+debugString2(e[n]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let n;if(!(r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}function makeMutClosure2(e,t,r,n){const o={a:e,b:t,cnt:1,dtor:r},i=(...e)=>{o.cnt++;const t=o.a;o.a=0;try{return n(t,o.b,...e)}finally{0==--o.cnt?(wasm2.__wbindgen_export_2.get(o.dtor)(t,o.b),CLOSURE_DTORS2.unregister(o)):o.a=t}};return i.original=o,CLOSURE_DTORS2.register(i,o,o),i}function __wbg_adapter_50(e,t,r){wasm2.__wbindgen_export_3(e,t,addHeapObject2(r))}function handleError2(e,t){try{return e.apply(this,t)}catch(e){wasm2.__wbindgen_export_5(addHeapObject2(e))}}function __wbg_adapter_105(e,t,r,n){wasm2.__wbindgen_export_6(e,t,addHeapObject2(r),addHeapObject2(n))}function passArray8ToWasm02(e,t){const r=t(1*e.length,1)>>>0;return getUint8Memory02().set(e,r/1),WASM_VECTOR_LEN2=e.length,r}function get_font_info(e){return takeObject2(wasm2.get_font_info(addHeapObject2(e)))}function getUint32Memory02(){return null!==cachedUint32Memory02&&0!==cachedUint32Memory02.byteLength||(cachedUint32Memory02=new Uint32Array(wasm2.memory.buffer)),cachedUint32Memory02}function getArrayJsValueFromWasm0(e,t){e>>>=0;const r=getUint32Memory02().subarray(e/4,e/4+t),n=[];for(let e=0;e<r.length;e++)n.push(takeObject2(r[e]));return n}function _assertClass2(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`);return e.ptr}function getArrayU8FromWasm0(e,t){return e>>>=0,getUint8Memory02().subarray(e/1,e/1+t)}async function __wbg_load2(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}function __wbg_get_imports2(){const e={wbg:{}};return e.wbg.__wbg_new_abda76e883ba8a5f=function(){return addHeapObject2(new Error)},e.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=passStringToWasm02(getObject2(t).stack,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),n=WASM_VECTOR_LEN2;getInt32Memory02()[e/4+1]=n,getInt32Memory02()[e/4+0]=r},e.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,n;try{r=e,n=t,console.error(getStringFromWasm02(e,t))}finally{wasm2.__wbindgen_export_4(r,n,1)}},e.wbg.__wbindgen_object_drop_ref=function(e){takeObject2(e)},e.wbg.__wbg_iterator_2cee6dadfd956dfa=function(){return addHeapObject2(Symbol.iterator)},e.wbg.__wbg_get_e3c254076557e348=function(){return handleError2((function(e,t){return addHeapObject2(Reflect.get(getObject2(e),getObject2(t)))}),arguments)},e.wbg.__wbindgen_is_function=function(e){return"function"==typeof getObject2(e)},e.wbg.__wbg_call_27c0f87801dedf93=function(){return handleError2((function(e,t){return addHeapObject2(getObject2(e).call(getObject2(t)))}),arguments)},e.wbg.__wbindgen_is_object=function(e){const t=getObject2(e);return"object"==typeof t&&null!==t},e.wbg.__wbg_next_40fc327bfc8770e6=function(e){return addHeapObject2(getObject2(e).next)},e.wbg.__wbg_length_c20a40f15020d68a=function(e){return getObject2(e).length},e.wbg.__wbindgen_memory=function(){return addHeapObject2(wasm2.memory)},e.wbg.__wbg_buffer_12d079cc21e14bdb=function(e){return addHeapObject2(getObject2(e).buffer)},e.wbg.__wbg_new_63b92bc8671ed464=function(e){return addHeapObject2(new Uint8Array(getObject2(e)))},e.wbg.__wbg_set_a47bac70306a19a7=function(e,t,r){getObject2(e).set(getObject2(t),r>>>0)},e.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return handleError2((function(){return addHeapObject2(self.self)}),arguments)},e.wbg.__wbg_window_c6fb939a7f436783=function(){return handleError2((function(){return addHeapObject2(window.window)}),arguments)},e.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return handleError2((function(){return addHeapObject2(globalThis.globalThis)}),arguments)},e.wbg.__wbg_global_207b558942527489=function(){return handleError2((function(){return addHeapObject2(global.global)}),arguments)},e.wbg.__wbindgen_is_undefined=function(e){return void 0===getObject2(e)},e.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(e,t){return addHeapObject2(new Function(getStringFromWasm02(e,t)))},e.wbg.__wbg_new_28c511d9baebfa89=function(e,t){return addHeapObject2(new Error(getStringFromWasm02(e,t)))},e.wbg.__wbindgen_error_new=function(e,t){return addHeapObject2(new Error(getStringFromWasm02(e,t)))},e.wbg.__wbg_instanceof_Object_71ca3c0a59266746=function(e){let t;try{t=getObject2(e)instanceof Object}catch(e){t=!1}return t},e.wbg.__wbg_entries_95cc2c823b285a09=function(e){return addHeapObject2(Object.entries(getObject2(e)))},e.wbg.__wbg_length_cd7af8117672b8b8=function(e){return getObject2(e).length},e.wbg.__wbg_get_bd8e338fbd5f5cc8=function(e,t){return addHeapObject2(getObject2(e)[t>>>0])},e.wbg.__wbindgen_string_get=function(e,t){const r=getObject2(t),n="string"==typeof r?r:void 0;var o=isLikeNone2(n)?0:passStringToWasm02(n,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),i=WASM_VECTOR_LEN2;getInt32Memory02()[e/4+1]=i,getInt32Memory02()[e/4+0]=o},e.wbg.__wbindgen_object_clone_ref=function(e){return addHeapObject2(getObject2(e))},e.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,t){return addHeapObject2(getObject2(e)[getObject2(t)])},e.wbg.__wbindgen_in=function(e,t){return getObject2(e)in getObject2(t)},e.wbg.__wbg_isArray_2ab64d95e09ea0ae=function(e){return Array.isArray(getObject2(e))},e.wbg.__wbg_next_196c84450b364254=function(){return handleError2((function(e){return addHeapObject2(getObject2(e).next())}),arguments)},e.wbg.__wbg_done_298b57d23c0fc80c=function(e){return getObject2(e).done},e.wbg.__wbg_value_d93c65011f51a456=function(e){return addHeapObject2(getObject2(e).value)},e.wbg.__wbindgen_string_new=function(e,t){return addHeapObject2(getStringFromWasm02(e,t))},e.wbg.__wbg_log_411c0994e7c648bf=function(e,t,r){console.log(getObject2(e),getObject2(t),getObject2(r))},e.wbg.__wbindgen_number_new=function(e){return addHeapObject2(e)},e.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return handleError2((function(e,t,r){return addHeapObject2(getObject2(e).call(getObject2(t),getObject2(r)))}),arguments)},e.wbg.__wbg_instanceof_ArrayBuffer_836825be07d4c9d2=function(e){let t;try{t=getObject2(e)instanceof ArrayBuffer}catch(e){t=!1}return t},e.wbg.__wbindgen_jsval_loose_eq=function(e,t){return getObject2(e)==getObject2(t)},e.wbg.__wbindgen_is_string=function(e){return"string"==typeof getObject2(e)},e.wbg.__wbg_isSafeInteger_f7b04ef02296c4d2=function(e){return Number.isSafeInteger(getObject2(e))},e.wbg.__wbindgen_as_number=function(e){return+getObject2(e)},e.wbg.__wbindgen_boolean_get=function(e){const t=getObject2(e);return"boolean"==typeof t?t?1:0:2},e.wbg.__wbindgen_is_bigint=function(e){return"bigint"==typeof getObject2(e)},e.wbg.__wbindgen_number_get=function(e,t){const r=getObject2(t),n="number"==typeof r?r:void 0;getFloat64Memory0()[e/8+1]=isLikeNone2(n)?0:n,getInt32Memory02()[e/4+0]=!isLikeNone2(n)},e.wbg.__wbg_instanceof_Map_87917e0a7aaf4012=function(e){let t;try{t=getObject2(e)instanceof Map}catch(e){t=!1}return t},e.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const r=getObject2(t),n="bigint"==typeof r?r:void 0;getBigInt64Memory0()[e/8+1]=isLikeNone2(n)?BigInt(0):n,getInt32Memory02()[e/4+0]=!isLikeNone2(n)},e.wbg.__wbindgen_bigint_from_i64=function(e){return addHeapObject2(e)},e.wbg.__wbindgen_jsval_eq=function(e,t){return getObject2(e)===getObject2(t)},e.wbg.__wbindgen_bigint_from_u64=function(e){return addHeapObject2(BigInt.asUintN(64,e))},e.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(e,t,r){return addHeapObject2(new Uint8Array(getObject2(e),t>>>0,r>>>0))},e.wbg.__wbg_call_938992c832f74314=function(){return handleError2((function(e,t,r,n,o){return addHeapObject2(getObject2(e).call(getObject2(t),getObject2(r),getObject2(n),getObject2(o)))}),arguments)},e.wbg.__wbg_instanceof_Uint8Array_2b3bbecd033d19f6=function(e){let t;try{t=getObject2(e)instanceof Uint8Array}catch(e){t=!1}return t},e.wbg.__wbg_new_72fb9a18b5ae2624=function(){return addHeapObject2(new Object)},e.wbg.__wbg_new_16b304a2cfa7ff4a=function(){return addHeapObject2(new Array)},e.wbg.__wbg_set_f975102236d3c502=function(e,t,r){getObject2(e)[takeObject2(t)]=takeObject2(r)},e.wbg.__wbg_set_d4638f722068f043=function(e,t,r){getObject2(e)[t>>>0]=takeObject2(r)},e.wbg.__wbg_now_3014639a94423537=function(){return Date.now()},e.wbg.__wbg_newwithbyteoffsetandlength_3125852e5a7fbcff=function(e,t,r){return addHeapObject2(new Uint32Array(getObject2(e),t>>>0,r>>>0))},e.wbg.__wbg_new_2afb9348997957e9=function(e){return addHeapObject2(new Uint32Array(getObject2(e)))},e.wbg.__wbg_set_1f9b04f170055d33=function(){return handleError2((function(e,t,r){return Reflect.set(getObject2(e),getObject2(t),getObject2(r))}),arguments)},e.wbg.__wbg_push_a5b05aedc7234f9f=function(e,t){return getObject2(e).push(getObject2(t))},e.wbg.__wbg_error_74e3211912fcadb6=function(e,t,r){console.error(getObject2(e),getObject2(t),getObject2(r))},e.wbg.__wbg_proxycontext_new=function(e){return addHeapObject2(ProxyContext.__wrap(e))},e.wbg.__wbg_newwithargs_33d0ffcb48344669=function(e,t,r,n){return addHeapObject2(new Function(getStringFromWasm02(e,t),getStringFromWasm02(r,n)))},e.wbg.__wbg_new_81740750da40724f=function(e,t){try{var r={a:e,b:t};return addHeapObject2(new Promise(((e,t)=>{const n=r.a;r.a=0;try{return __wbg_adapter_105(n,r.b,e,t)}finally{r.a=n}})))}finally{r.a=r.b=0}},e.wbg.__wbg_typstcompiler_new=function(e){return addHeapObject2(TypstCompiler.__wrap(e))},e.wbg.__wbindgen_debug_string=function(e,t){const r=passStringToWasm02(debugString2(getObject2(t)),wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),n=WASM_VECTOR_LEN2;getInt32Memory02()[e/4+1]=n,getInt32Memory02()[e/4+0]=r},e.wbg.__wbindgen_throw=function(e,t){throw new Error(getStringFromWasm02(e,t))},e.wbg.__wbg_queueMicrotask_3cbae2ec6b6cd3d6=function(e){return addHeapObject2(getObject2(e).queueMicrotask)},e.wbg.__wbg_resolve_b0083a7967828ec8=function(e){return addHeapObject2(Promise.resolve(getObject2(e)))},e.wbg.__wbindgen_cb_drop=function(e){const t=takeObject2(e).original;return 1==t.cnt--&&(t.a=0,!0)},e.wbg.__wbg_then_0c86a60e8fcfe9f6=function(e,t){return addHeapObject2(getObject2(e).then(getObject2(t)))},e.wbg.__wbg_queueMicrotask_481971b0d87f3dd4=function(e){queueMicrotask(getObject2(e))},e.wbg.__wbindgen_closure_wrapper13738=function(e,t,r){return addHeapObject2(makeMutClosure2(e,t,1336,__wbg_adapter_50))},e}function __wbg_init_memory2(e,t){}function __wbg_finalize_init2(e,t){return wasm2=e.exports,__wbg_init2.__wbindgen_wasm_module=t,cachedBigInt64Memory0=null,cachedFloat64Memory0=null,cachedInt32Memory02=null,cachedUint32Memory02=null,cachedUint8Memory02=null,wasm2}function initSync2(e){if(void 0!==wasm2)return wasm2;const t=__wbg_get_imports2();return __wbg_init_memory2(t),e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e)),__wbg_finalize_init2(new WebAssembly.Instance(e,t),e)}async function __wbg_init2(e){if(void 0!==wasm2)return wasm2;void 0===e&&(e=importWasmModule2("typst_ts_web_compiler_bg.wasm",import.meta.url));const t=__wbg_get_imports2();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e)),__wbg_init_memory2(t);const{instance:r,module:n}=await __wbg_load2(await e,t);return __wbg_finalize_init2(r,n)}function setImportWasmModule2(e){importWasmModule2=e}var wasm_pack_shim_default2,nodeJsImportWasmModule2,isNode2,init_typst_ts_web_compiler=__esm({"../compiler/pkg/typst_ts_web_compiler.mjs"(){(heap2=new Array(128).fill(void 0)).push(void 0,null,!0,!1),heap_next2=heap2.length,cachedTextDecoder2="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}},"undefined"!=typeof TextDecoder&&cachedTextDecoder2.decode(),cachedUint8Memory02=null,WASM_VECTOR_LEN2=0,cachedTextEncoder2="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},encodeString2="function"==typeof cachedTextEncoder2.encodeInto?function(e,t){return cachedTextEncoder2.encodeInto(e,t)}:function(e,t){const r=cachedTextEncoder2.encode(e);return t.set(r),{read:e.length,written:r.length}},cachedInt32Memory02=null,cachedFloat64Memory0=null,cachedBigInt64Memory0=null,CLOSURE_DTORS2="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>{wasm2.__wbindgen_export_2.get(e.dtor)(e.a,e.b)})),cachedUint32Memory02=null,IncrServerFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm2.__wbg_incrserver_free(e>>>0))),IncrServer=class{static __wrap(e){e>>>=0;const t=Object.create(IncrServer.prototype);return t.__wbg_ptr=e,IncrServerFinalization.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,IncrServerFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm2.__wbg_incrserver_free(e)}set_attach_debug_info(e){wasm2.incrserver_set_attach_debug_info(this.__wbg_ptr,e)}current(){try{const r=wasm2.__wbindgen_add_to_stack_pointer(-16);wasm2.incrserver_current(r,this.__wbg_ptr);var e=getInt32Memory02()[r/4+0],t=getInt32Memory02()[r/4+1];let n;return 0!==e&&(n=getArrayU8FromWasm0(e,t).slice(),wasm2.__wbindgen_export_4(e,1*t,1)),n}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}reset(){wasm2.incrserver_reset(this.__wbg_ptr)}},ProxyContextFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm2.__wbg_proxycontext_free(e>>>0))),ProxyContext=class{static __wrap(e){e>>>=0;const t=Object.create(ProxyContext.prototype);return t.__wbg_ptr=e,ProxyContextFinalization.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ProxyContextFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm2.__wbg_proxycontext_free(e)}constructor(e){const t=wasm2.proxycontext_new(addHeapObject2(e));return this.__wbg_ptr=t>>>0,this}get context(){return takeObject2(wasm2.proxycontext_context(this.__wbg_ptr))}untar(e,t){try{const n=wasm2.__wbindgen_add_to_stack_pointer(-16),o=passArray8ToWasm02(e,wasm2.__wbindgen_export_0),i=WASM_VECTOR_LEN2;wasm2.proxycontext_untar(n,this.__wbg_ptr,o,i,addHeapObject2(t));var r=getInt32Memory02()[n/4+0];if(getInt32Memory02()[n/4+1])throw takeObject2(r)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}},TypstCompilerFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm2.__wbg_typstcompiler_free(e>>>0))),TypstCompiler=class{static __wrap(e){e>>>=0;const t=Object.create(TypstCompiler.prototype);return t.__wbg_ptr=e,TypstCompilerFinalization.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,TypstCompilerFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm2.__wbg_typstcompiler_free(e)}reset(){try{const t=wasm2.__wbindgen_add_to_stack_pointer(-16);wasm2.typstcompiler_reset(t,this.__wbg_ptr);var e=getInt32Memory02()[t/4+0];if(getInt32Memory02()[t/4+1])throw takeObject2(e)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}set_inputs(e){try{const r=wasm2.__wbindgen_add_to_stack_pointer(-16);wasm2.typstcompiler_set_inputs(r,this.__wbg_ptr,addHeapObject2(e));var t=getInt32Memory02()[r/4+0];if(getInt32Memory02()[r/4+1])throw takeObject2(t)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}add_source(e,t){const r=passStringToWasm02(e,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),n=WASM_VECTOR_LEN2,o=passStringToWasm02(t,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),i=WASM_VECTOR_LEN2;return 0!==wasm2.typstcompiler_add_source(this.__wbg_ptr,r,n,o,i)}map_shadow(e,t){const r=passStringToWasm02(e,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),n=WASM_VECTOR_LEN2,o=passArray8ToWasm02(t,wasm2.__wbindgen_export_0),i=WASM_VECTOR_LEN2;return 0!==wasm2.typstcompiler_add_source(this.__wbg_ptr,r,n,o,i)}unmap_shadow(e){const t=passStringToWasm02(e,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),r=WASM_VECTOR_LEN2;return 0!==wasm2.typstcompiler_unmap_shadow(this.__wbg_ptr,t,r)}reset_shadow(){wasm2.typstcompiler_reset_shadow(this.__wbg_ptr)}get_loaded_fonts(){try{const n=wasm2.__wbindgen_add_to_stack_pointer(-16);wasm2.typstcompiler_get_loaded_fonts(n,this.__wbg_ptr);var e=getInt32Memory02()[n/4+0],t=getInt32Memory02()[n/4+1],r=getArrayJsValueFromWasm0(e,t).slice();return wasm2.__wbindgen_export_4(e,4*t,4),r}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}get_ast(e){let t,r;try{const c=wasm2.__wbindgen_add_to_stack_pointer(-16),d=passStringToWasm02(e,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),g=WASM_VECTOR_LEN2;wasm2.typstcompiler_get_ast(c,this.__wbg_ptr,d,g);var n=getInt32Memory02()[c/4+0],o=getInt32Memory02()[c/4+1],i=getInt32Memory02()[c/4+2],s=getInt32Memory02()[c/4+3],a=n,_=o;if(s)throw a=0,_=0,takeObject2(i);return t=a,r=_,getStringFromWasm02(a,_)}finally{wasm2.__wbindgen_add_to_stack_pointer(16),wasm2.__wbindgen_export_4(t,r,1)}}get_semantic_token_legend(){try{const r=wasm2.__wbindgen_add_to_stack_pointer(-16);wasm2.typstcompiler_get_semantic_token_legend(r,this.__wbg_ptr);var e=getInt32Memory02()[r/4+0],t=getInt32Memory02()[r/4+1];if(getInt32Memory02()[r/4+2])throw takeObject2(t);return takeObject2(e)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}get_semantic_tokens(e,t,r){try{const c=wasm2.__wbindgen_add_to_stack_pointer(-16),d=passStringToWasm02(e,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),g=WASM_VECTOR_LEN2;var n=isLikeNone2(t)?0:passStringToWasm02(t,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),o=WASM_VECTOR_LEN2,i=isLikeNone2(r)?0:passStringToWasm02(r,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),s=WASM_VECTOR_LEN2;wasm2.typstcompiler_get_semantic_tokens(c,this.__wbg_ptr,d,g,n,o,i,s);var a=getInt32Memory02()[c/4+0],_=getInt32Memory02()[c/4+1];if(getInt32Memory02()[c/4+2])throw takeObject2(_);return takeObject2(a)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}get_artifact(e,t){try{const o=wasm2.__wbindgen_add_to_stack_pointer(-16),i=passStringToWasm02(e,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),s=WASM_VECTOR_LEN2;wasm2.typstcompiler_get_artifact(o,this.__wbg_ptr,i,s,t);var r=getInt32Memory02()[o/4+0],n=getInt32Memory02()[o/4+1];if(getInt32Memory02()[o/4+2])throw takeObject2(n);return takeObject2(r)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}query(e,t,r){let n,o;try{const u=wasm2.__wbindgen_add_to_stack_pointer(-16),l=passStringToWasm02(e,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),b=WASM_VECTOR_LEN2,p=passStringToWasm02(t,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),m=WASM_VECTOR_LEN2;var i=isLikeNone2(r)?0:passStringToWasm02(r,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),s=WASM_VECTOR_LEN2;wasm2.typstcompiler_query(u,this.__wbg_ptr,l,b,p,m,i,s);var a=getInt32Memory02()[u/4+0],_=getInt32Memory02()[u/4+1],c=getInt32Memory02()[u/4+2],d=getInt32Memory02()[u/4+3],g=a,w=_;if(d)throw g=0,w=0,takeObject2(c);return n=g,o=w,getStringFromWasm02(g,w)}finally{wasm2.__wbindgen_add_to_stack_pointer(16),wasm2.__wbindgen_export_4(n,o,1)}}compile(e,t,r){try{const i=wasm2.__wbindgen_add_to_stack_pointer(-16),s=passStringToWasm02(e,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),a=WASM_VECTOR_LEN2,_=passStringToWasm02(t,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),c=WASM_VECTOR_LEN2;wasm2.typstcompiler_compile(i,this.__wbg_ptr,s,a,_,c,r);var n=getInt32Memory02()[i/4+0],o=getInt32Memory02()[i/4+1];if(getInt32Memory02()[i/4+2])throw takeObject2(o);return takeObject2(n)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}create_incr_server(){try{const r=wasm2.__wbindgen_add_to_stack_pointer(-16);wasm2.typstcompiler_create_incr_server(r,this.__wbg_ptr);var e=getInt32Memory02()[r/4+0],t=getInt32Memory02()[r/4+1];if(getInt32Memory02()[r/4+2])throw takeObject2(t);return IncrServer.__wrap(e)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}incr_compile(e,t,r){try{const i=wasm2.__wbindgen_add_to_stack_pointer(-16),s=passStringToWasm02(e,wasm2.__wbindgen_export_0,wasm2.__wbindgen_export_1),a=WASM_VECTOR_LEN2;_assertClass2(t,IncrServer),wasm2.typstcompiler_incr_compile(i,this.__wbg_ptr,s,a,t.__wbg_ptr,r);var n=getInt32Memory02()[i/4+0],o=getInt32Memory02()[i/4+1];if(getInt32Memory02()[i/4+2])throw takeObject2(o);return takeObject2(n)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}},TypstCompilerBuilderFinalization="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>wasm2.__wbg_typstcompilerbuilder_free(e>>>0))),TypstCompilerBuilder=class{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,TypstCompilerBuilderFinalization.unregister(this),e}free(){const e=this.__destroy_into_raw();wasm2.__wbg_typstcompilerbuilder_free(e)}constructor(){try{const r=wasm2.__wbindgen_add_to_stack_pointer(-16);wasm2.typstcompilerbuilder_new(r);var e=getInt32Memory02()[r/4+0],t=getInt32Memory02()[r/4+1];if(getInt32Memory02()[r/4+2])throw takeObject2(t);return this.__wbg_ptr=e>>>0,this}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}set_dummy_access_model(){try{const t=wasm2.__wbindgen_add_to_stack_pointer(-16);wasm2.typstcompilerbuilder_set_dummy_access_model(t,this.__wbg_ptr);var e=getInt32Memory02()[t/4+0];if(getInt32Memory02()[t/4+1])throw takeObject2(e)}finally{wasm2.__wbindgen_add_to_stack_pointer(16)}}set_access_model(e,t,r,n,o){return takeObject2(wasm2.typstcompilerbuilder_set_access_model(this.__wbg_ptr,addHeapObject2(e),addHeapObject2(t),addHeapObject2(r),addHeapObject2(n),addHeapObject2(o)))}set_package_registry(e,t){return takeObject2(wasm2.typstcompilerbuilder_set_package_registry(this.__wbg_ptr,addHeapObject2(e),addHeapObject2(t)))}add_raw_font(e){return takeObject2(wasm2.typstcompilerbuilder_add_raw_font(this.__wbg_ptr,addHeapObject2(e)))}add_web_fonts(e){return takeObject2(wasm2.typstcompilerbuilder_add_web_fonts(this.__wbg_ptr,addHeapObject2(e)))}add_glyph_pack(e){return takeObject2(wasm2.typstcompilerbuilder_add_glyph_pack(this.__wbg_ptr,addHeapObject2(e)))}build(){const e=this.__destroy_into_raw();return takeObject2(wasm2.typstcompilerbuilder_build(e))}},typst_ts_web_compiler_default=__wbg_init2,importWasmModule2=async function(e,t){throw new Error("Cannot import wasm module without importer: "+e+" "+t)}}}),wasm_pack_shim_exports2={};__export(wasm_pack_shim_exports2,{IncrServer:()=>IncrServer,ProxyContext:()=>ProxyContext,TypstCompiler:()=>TypstCompiler,TypstCompilerBuilder:()=>TypstCompilerBuilder,default:()=>wasm_pack_shim_default2,get_font_info:()=>get_font_info,initSync:()=>initSync2,setImportWasmModule:()=>setImportWasmModule2});var init_wasm_pack_shim2=__esm({"../compiler/pkg/wasm-pack-shim.mjs"(){init_typst_ts_web_compiler(),init_typst_ts_web_compiler(),init_typst_ts_web_compiler(),wasm_pack_shim_default2=typst_ts_web_compiler_default,nodeJsImportWasmModule2=async function(e,t){const r=new Function("m","return import(m)"),n=await r("path"),{readFileSync:o}=await r("fs"),i=new URL(n.join(n.dirname(t),e));return await o(i).buffer},(isNode2="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node)&&setImportWasmModule2(nodeJsImportWasmModule2)}}),BeforeBuildSymbol=Symbol("beforeBuild"),_textFonts=["LinLibertine_R.ttf","LinLibertine_RB.ttf","LinLibertine_RBI.ttf","LinLibertine_RI.ttf","NewCMMath-Book.otf","NewCMMath-Regular.otf","NewCM10-Regular.otf","NewCM10-Bold.otf","NewCM10-Italic.otf","NewCM10-BoldItalic.otf","DejaVuSansMono.ttf","DejaVuSansMono-Bold.ttf","DejaVuSansMono-Oblique.ttf","DejaVuSansMono-BoldOblique.ttf"],_cjkFonts=["InriaSerif-Bold.ttf","InriaSerif-BoldItalic.ttf","InriaSerif-Italic.ttf","InriaSerif-Regular.ttf","Roboto-Regular.ttf","NotoSerifCJKsc-Regular.otf"],_emojiFonts=["TwitterColorEmoji.ttf","NotoColorEmoji.ttf"];function preloadRemoteFonts(e,t){const r=[...e];if(t&&!1!==t?.assets&&t?.assets?.length&&t?.assets?.length>0){let e=t.assetUrlPrefix??"https://raw.githubusercontent.com/Myriad-Dreamin/typst/assets-fonts";"/"!==e[e.length-1]&&(e+="/");const n=t=>t.map((t=>e+t));for(const e of t.assets)switch(e){case"text":r.push(...n(_textFonts));break;case"cjk":r.push(...n(_cjkFonts));break;case"emoji":r.push(...n(_emojiFonts))}}const n=async(e,{ref:n,builder:o})=>{t?.fetcher&&n.setFetcher(t.fetcher),await n.loadFonts(o,r)};return n._preloadRemoteFontOptions=t,n}function preloadSystemFonts({byFamily:e}){return async(t,{builder:r})=>{const n=performance.now();if("queryLocalFonts"in window){const t=await window.queryLocalFonts();e=e??[];for(const n of t){if(!e.includes(n.family))continue;const t=await(await n.blob()).arrayBuffer();await r.add_raw_font(new Uint8Array(t))}}const o=performance.now();console.log("preload system font time used:",o-n)}}function withPackageRegistry(e){return async(t,{builder:r})=>new Promise((t=>{r.set_package_registry(e,(function(t){return e.resolve(t,this)})),t()}))}function withAccessModel(e){return async(t,r)=>{if(r.alreadySetAccessModel)throw new Error(`already set some assess model before: ${r.alreadySetAccessModel.constructor?.name}(${r.alreadySetAccessModel})`);return r.alreadySetAccessModel=e,new Promise((t=>{r.builder.set_access_model(e,(t=>{const r=e.getMTime(t);return r?r.getTime():0}),(t=>e.isFile(t)||!1),(t=>e.getRealPath(t)||t),(t=>e.readAll(t))),t()}))}}var idbProxyableTypes,cursorAdvanceMethods,kObject=Symbol.for("reflexo-obj"),RenderView=class{constructor(e,t,r){this.pageInfos=e,this.imageScaleFactor=r.pixelPerPt??3,t.innerHTML="",t.style.width="100%",this.container=t,this.canvasList=new Array(this.loadPageCount),this.textLayerList=new Array(this.loadPageCount),this.commonList=new Array(this.loadPageCount),this.textLayerParentList=new Array(this.loadPageCount),this.semanticLayerList=new Array(this.loadPageCount);const n=(e,r,n)=>{const o=Math.ceil(r.width)*this.imageScaleFactor,i=Math.ceil(r.height)*this.imageScaleFactor,s=this.canvasList[e]=document.createElement("canvas"),a=this.semanticLayerList[e]=document.createElement("div"),_=this.textLayerList[e]=document.createElement("div"),c=this.textLayerParentList[e]=document.createElement("div");if(s.getContext("2d")){const e=document.createElement("div");s.width=o,s.height=i,e.appendChild(s),n.appendChild(e),e.style.position="absolute"}{c.appendChild(_),c.className="typst-html-semantics";const e=t.offsetWidth,o=e/r.width;c.style.width=`${e}px`,c.style.height=r.height*o+"px",c.style.setProperty("--data-text-width",`${o}px`),c.style.setProperty("--data-text-height",`${o}px`),n.classList.add("typst-page"),n.classList.add("canvas"),n.style.width=`${e}px`,n.style.height=i*o+"px",n.style.position="relative",a.appendChild(c),n.appendChild(a)}};for(let e=0;e<this.pageInfos.length;e++){const r=this.pageInfos[e];let o;o=this.commonList[e]=document.createElement("div"),t.appendChild(o),n(e,r,o)}}resetLayout(){for(let e=0;e<this.pageInfos.length;e++){const t=this.pageInfos[e],r=Math.ceil(t.width)*this.imageScaleFactor,n=Math.ceil(t.height)*this.imageScaleFactor,o=this.canvasList[e].parentElement;if(!o)throw new Error(`canvasDiv is null for page ${e}, canvas list length ${this.canvasList.length}`);const i=this.commonList[e],s=this.textLayerParentList[e],a=this.container.offsetWidth,_=a/r;s.style.width=`${a}px`,s.style.height=n*_+"px",i.style.width=`${a}px`,i.style.height=n*_+"px";const c=this.container.offsetWidth/r;o.style.transformOrigin="0px 0px",o.style.transform=`scale(${c})`}}},once=e=>{let t,r=!1;return()=>r?t:(r=!0,t=e())},LazyWasmModule=class{constructor(e){if("function"!=typeof e)throw new Error("initFn is not a function");this.initOnce=once((async()=>{await e(this.wasmBin)}))}async init(e){this.wasmBin=e,await this.initOnce()}},instanceOfAny=(e,t)=>t.some((t=>e instanceof t));function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(e){const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(wrap(e.result)),n()},i=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&cursorRequestMap.set(t,e)})).catch((()=>{})),reverseTransformCache.set(t,e),t}function cacheDonePromiseForTransaction(e){if(transactionDoneMap.has(e))return;const t=new Promise(((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),n()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)}));transactionDoneMap.set(e,t)}var idbProxyTraps={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return transactionDoneMap.get(e);if("objectStoreNames"===t)return e.objectStoreNames||transactionStoreNamesMap.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return wrap(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function replaceTraps(e){idbProxyTraps=e(idbProxyTraps)}function wrapFunction(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?getCursorAdvanceMethods().includes(e)?function(...t){return e.apply(unwrap(this),t),wrap(cursorRequestMap.get(this))}:function(...t){return wrap(e.apply(unwrap(this),t))}:function(t,...r){const n=e.call(unwrap(this),t,...r);return transactionStoreNamesMap.set(n,t.sort?t.sort():[t]),wrap(n)}}function transformCachableValue(e){return"function"==typeof e?wrapFunction(e):(e instanceof IDBTransaction&&cacheDonePromiseForTransaction(e),instanceOfAny(e,getIdbProxyableTypes())?new Proxy(e,idbProxyTraps):e)}function wrap(e){if(e instanceof IDBRequest)return promisifyRequest(e);if(transformCache.has(e))return transformCache.get(e);const t=transformCachableValue(e);return t!==e&&(transformCache.set(e,t),reverseTransformCache.set(t,e)),t}var unwrap=e=>reverseTransformCache.get(e),readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(cachedMethods.get(t))return cachedMethods.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,o=writeMethods.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!o&&!readMethods.includes(r))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let s=i.store;return n&&(s=s.index(t.shift())),(await Promise.all([s[r](...t),o&&i.done]))[0]};return cachedMethods.set(t,i),i}replaceTraps((e=>({...e,get:(t,r,n)=>getMethod(t,r)||e.get(t,r,n),has:(t,r)=>!!getMethod(t,r)||e.has(t,r)})));var ComponentBuilder=class{constructor(){this.loadedFonts=new Set,this.fetcher=fetch}setFetcher(e){this.fetcher=e}async loadFonts(e,t){const r=new Function("m","return import(m)"),n=this.fetcher||(this.fetcher=await async function(){const{fetchBuilder:e,FileSystemCache:t}=await r("node-fetch-cache"),n=new t({cacheDirectory:".cache/typst/fonts"}),o=e.withCache(n);return function(e,t){const r=setTimeout((()=>{console.warn("font fetching is stucking:",e)}),15e3);return o(e,t).finally((()=>{clearTimeout(r)}))}}()),o=t.filter((e=>e instanceof Uint8Array||!this.loadedFonts.has(e)&&(this.loadedFonts.add(e),!0))),i=await Promise.all(o.map((async t=>{if(!(t instanceof Uint8Array))return new Uint8Array(await(await n(t)).arrayBuffer());await e.add_raw_font(t)})));for(const t of i)t&&await e.add_raw_font(t)}async build(e,t,r){const n={ref:this,builder:t,hooks:r};for(const t of e?.beforeBuild??[])await t(void 0,n);return r.latelyBuild&&r.latelyBuild(n),await t.build()}};async function buildComponent(e,t,r,n){return await t.init(e?.getModule?.()),await(new ComponentBuilder).build(e,new r,n)}var TypstDocumentContext=class{constructor(e){this.modes=[],this.partialRendering=!0,this.renderMode="svg",this.r=void 0,this.previewMode=0,this.isContentPreview=!1,this.isMixinOutline=!1,this.backgroundColor="black",this.pageColor="white",this.pixelPerPt=3,this.isRendering=!1,this.moduleInitialized=!1,this.patchQueue=[],this.disposeList=[],this.currentRealScale=1,this.currentScaleRatio=1,this.vpTimeout=void 0,this.sampledRenderTime=0,this.partialRenderPage=0,this.outline=void 0,this.cursorPosition=void 0,this.cachedDOMState={width:0,height:0,window:{innerWidth:0,innerHeight:0},boundingRect:{left:0,top:0,right:0}},this.hookedElem=e.hookedElem,this.kModule=e.kModule,this.opts=e||{};{const{renderMode:t,previewMode:r,isContentPreview:n,retrieveDOMState:o}=e||{};this.partialRendering=!1,this.renderMode=t??this.renderMode,this.previewMode=r??this.previewMode,this.isContentPreview=n||!1,this.retrieveDOMState=o??(()=>({width:this.hookedElem.offsetWidth,height:this.hookedElem.offsetHeight,window:{innerWidth:window.innerWidth,innerHeight:window.innerHeight},boundingRect:this.hookedElem.getBoundingClientRect()})),this.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--typst-preview-background-color")}this.hookedElem.classList.add("hide-scrollbar-x"),this.hookedElem.parentElement?.classList.add("hide-scrollbar-x"),1===this.previewMode&&(this.hookedElem.classList.add("hide-scrollbar-y"),this.hookedElem.parentElement?.classList.add("hide-scrollbar-y")),this.installCtrlWheelHandler()}reset(){this.kModule.reset(),this.moduleInitialized=!1}dispose(){const e=this.disposeList;this.disposeList=[],e.forEach((e=>e()))}static derive(e,t){return["rescale","rerender","postRender"].reduce(((r,n)=>(r[n]=e[`${n}$${t}`].bind(e),console.assert(void 0!==r[n],`${n}$${t} is undefined`),r)),{})}registerMode(e){const t=TypstDocumentContext.derive(this,e);this.modes.push([e,t]),e===this.renderMode&&(this.r=t)}installCtrlWheelHandler(){const e=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],t=t=>{if(t.ctrlKey){t.preventDefault(),this.cachedDOMState=this.retrieveDOMState(),null!==window.onresize&&(window.onresize=null);const r=this.currentScaleRatio;if(t.deltaY<0){if(this.currentScaleRatio>=e.at(-1))return;this.currentScaleRatio=e.filter((e=>e>this.currentScaleRatio)).at(0)}else{if(!(t.deltaY>0))return;if(this.currentScaleRatio<=e.at(0))return;this.currentScaleRatio=e.filter((e=>e<this.currentScaleRatio)).at(-1)}const n=this.currentScaleRatio/r,o=t.pageX*(n-1),i=t.pageY*(n-1);Math.abs(this.currentScaleRatio-1)<1e-5?(this.hookedElem.classList.add("hide-scrollbar-x"),this.hookedElem.parentElement?.classList.add("hide-scrollbar-x"),1===this.previewMode&&(this.hookedElem.classList.add("hide-scrollbar-y"),this.hookedElem.parentElement?.classList.add("hide-scrollbar-y"))):(this.hookedElem.classList.remove("hide-scrollbar-x"),this.hookedElem.parentElement?.classList.remove("hide-scrollbar-x"),1===this.previewMode&&(this.hookedElem.classList.remove("hide-scrollbar-y"),this.hookedElem.parentElement?.classList.remove("hide-scrollbar-y")));const s=this.hookedElem.firstElementChild;if(s){const e=this.getSvgScaleRatio(),t=Number.parseFloat(s.getAttribute("data-height")),r=Math.ceil(t*e);this.hookedElem.style.height=2*r+"px"}return window.scrollBy(o,i),this.addViewportChange(),!1}};"dom"!==this.renderMode&&("undefined"!=typeof acquireVsCodeApi?(window.addEventListener("wheel",t,{passive:!1}),this.disposeList.push((()=>{window.removeEventListener("wheel",t)}))):(document.body.addEventListener("wheel",t,{passive:!1}),this.disposeList.push((()=>{document.body.removeEventListener("wheel",t)}))))}getSvgScaleRatio(){const e=this.hookedElem.firstElementChild;if(!e)return 0;const t=this.cachedDOMState,r=Number.parseFloat(e.getAttribute("data-width")||e.getAttribute("width")||"1"),n=Number.parseFloat(e.getAttribute("data-height")||e.getAttribute("height")||"1");return this.currentRealScale=1===this.previewMode?Math.min(t.width/r,t.height/n):t.width/r,this.currentRealScale*this.currentScaleRatio}processQueue(e){const t=e[0];switch(t){case"new":case"diff-v1":return"new"===t&&this.reset(),this.kModule.manipulateData({action:"merge",data:e[1]}),this.moduleInitialized=!0,!0;case"viewport-change":return!!this.moduleInitialized||(console.log("viewport-change before initialization"),!1);default:return console.log("svgUpdateEvent",e),!1}}triggerUpdate(){if(this.isRendering)return;this.isRendering=!0;const e=async()=>{if(this.cachedDOMState=this.retrieveDOMState(),0===this.patchQueue.length)return this.isRendering=!1,void this.postprocessChanges();try{let t=performance.now();const r=this.canvasRenderCToken;r&&(await r.cancel(),await r.wait(),this.canvasRenderCToken=void 0,console.log("cancel canvas rendering"));let n=!1;for(;this.patchQueue.length>0;)n=this.processQueue(this.patchQueue.shift())||n;let o=performance.now();n&&(this.r.rescale(),await this.r.rerender(),this.r.rescale());let i=performance.now();const s=(e,t,r)=>`${e} ${(r-t).toFixed(2)} ms`;this.sampledRenderTime=i-t,console.log([s("parse",t,o),s("rerender",o,i),s("total",t,i)].join(", ")),requestAnimationFrame(e)}catch(e){console.error(e),this.isRendering=!1,this.postprocessChanges()}};requestAnimationFrame(e)}postprocessChanges(){this.r.postRender(),1===this.previewMode&&document.querySelectorAll(".typst-page-number-indicator").forEach((e=>{e.textContent=`${this.kModule.retrievePagesInfo().length}`}))}addChangement(e){"new"===e[0]&&this.patchQueue.splice(0,this.patchQueue.length);const t=()=>{this.vpTimeout=void 0,this.patchQueue.push(e),this.triggerUpdate()};void 0!==this.vpTimeout&&clearTimeout(this.vpTimeout),"viewport-change"===e[0]&&this.isRendering?this.vpTimeout=setTimeout(t,this.sampledRenderTime||100):t()}addViewportChange(){this.addChangement(["viewport-change",""])}};function provideDoc(e){return class{constructor(t){if(t.isContentPreview&&(t.renderMode="canvas"),this.kModule=t.kModule,this.impl=new e(t),!this.impl.r)throw new Error(`mode is not supported, ${t?.renderMode}`);t.isContentPreview&&(this.impl.partialRendering=!0,this.impl.pixelPerPt=1,this.impl.isMixinOutline=!0)}dispose(){this.impl.dispose()}reset(){this.impl.reset()}addChangement(e){this.impl.addChangement(e)}addViewportChange(){this.impl.addViewportChange()}setPageColor(e){this.impl.pageColor=e,this.addViewportChange()}setPartialRendering(e){this.impl.partialRendering=e}setCursor(e,t,r){this.impl.cursorPosition=[e,t,r]}setPartialPageNumber(e){return!(e<=0||e>this.kModule.retrievePagesInfo().length||(this.impl.partialRenderPage=e-1,this.addViewportChange(),0))}getPartialPageNumber(){return this.impl.partialRenderPage+1}setOutineData(e){this.impl.outline=e,this.addViewportChange()}}}function composeDoc(e,...t){return t.reduce(((e,t)=>t(e)),e)}var TypstCancellationToken=class{constructor(){let e,t;this.isCancellationRequested=!1,this._onCancelled=new Promise((r=>{e=r,t&&t(r)})),this._onCancelledResolveResolved=new Promise((r=>{t=r,e&&r(e)}))}async cancel(){await this._onCancelledResolveResolved,this.isCancellationRequested=!0}isCancelRequested(){return this.isCancellationRequested}async consume(){(await this._onCancelledResolveResolved)()}wait(){return this._onCancelled}},animationFrame=()=>new Promise((e=>requestAnimationFrame(e)));function provideDomDoc(e){return class extends e{constructor(...e){if(super(...e),this.tmpl=document.createElement("template"),this.stub=this.createElement("<stub></stub>"),this.resourceHeader=void 0,this.pages=[],this.domScale=1,this.track_mode=0,this.current_task=void 0,this.registerMode("dom"),this.disposeList.push((()=>{this.dispose()})),this.plugin=this.opts.renderer,void 0!==this.opts.domScale){if(this.opts.domScale<=0)throw new Error("domScale must be positive");this.domScale=this.opts.domScale}}dispose(){for(const e of this.pages)e.dispose();this.docKernel&&this.docKernel.free()}createElement(e){return this.tmpl.innerHTML=e,this.tmpl.content.firstElementChild}async mountDom(e){if(console.log("mountDom",e),this.docKernel)throw new Error("already mounted");this.hookedElem.innerHTML='<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>',this.resourceHeader=this.hookedElem.querySelector(".typst-svg-resources"),this.docKernel=await this.plugin.renderer.mount_dom(this.kModule[kObject],this.hookedElem),this.docKernel.bind_functions({populateGlyphs:e=>{let t=this.createElement(e);console.log("populateGlyphs",t);let r=t.firstElementChild;this.resourceHeader.append(r)}})}async cancelAnyway$dom(){if(console.log("cancelAnyway$dom"),this.current_task){const e=this.current_task;this.current_task=void 0,await e.cancel()}}retrieveDOMPages(){return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"))}postRender$dom(){}rescale$dom(){}getDomViewport(e,t){const r=t.left,n=-t.top,o=t.right,i=e.innerHeight-t.top,s={x:0,y:n/this.domScale,width:Math.max(o-r,0)/this.domScale,height:Math.max(i-n,0)/this.domScale};return(s.width<=0||s.height<=0)&&(s.x=s.y=s.width=s.height=0),s}async rerender$dom(){const e=this.retrieveDOMState(),{x:t,y:r,width:n,height:o}=this.getDomViewport(e.window,e.boundingRect);if(!await this.docKernel.relayout(t,r,n,o))return;const i=new TypstCancellationToken;this.doRender$dom(i),this.current_task=i}async doRender$dom(e){const t=this.retrieveDOMPages().map((e=>{const{innerWidth:t,innerHeight:r}=window,n=e.getBoundingClientRect();return{inWindow:!(n.left>t||n.right<0||n.top>r||n.bottom<0),page:e}})),r=async r=>{if(await animationFrame(),e.isCancelRequested())return void console.log("cancel stage",0,r);const n=t[r].page,o=n.getBoundingClientRect(),i=this.getDomViewport(window,o),s=e=>this.docKernel.need_repaint(r,i.x,i.y,i.width,i.height,e),a=e=>this.docKernel.repaint(r,i.x,i.y,i.width,i.height,e),_=t=>{if(!e.isCancelRequested())return((t,r)=>{if(t&&!e.isCancelRequested()&&r)return r()})(s(t),(()=>a(t)))};await _(0);const c=(o.width?Number.parseFloat(n.getAttribute("data-width"))/o.width:1)*this.domScale,d=(o.height?Number.parseFloat(n.getAttribute("data-height"))/o.height:1)*this.domScale;i.x*=c,i.y*=d,i.y-=100,i.width*=c,i.height*=d,i.height+=200,await _(1),await _(2),e.isCancelRequested()?console.log("cancel stage",2,r):s(3)?(async()=>{if(await a(3),!e.isCancelRequested())_(4)})():await _(4)},n=async n=>{for(let o=0;o<t.length;++o){if(e.isCancelRequested())return void console.log("cancel page",0,o);t[o].inWindow===n&&await r(o)}};this.cancelAnyway$dom(),await n(!0),await n(!1),e.isCancelRequested()||console.log("finished",0)}}}var TypstDomDocument=class extends(provideDoc(composeDoc(TypstDocumentContext,provideDomDoc))){},RenderSession2=class{constructor(e,t){this.plugin=e,this[kObject]=t}set backgroundColor(e){void 0!==e&&(this[kObject].background_color=e)}get backgroundColor(){return this[kObject].background_color}set pixelPerPt(e){void 0!==e&&(this[kObject].pixel_per_pt=e)}get pixelPerPt(){return this[kObject].pixel_per_pt}reset(){this.plugin.resetSession(this)}get doc_width(){return this[kObject].doc_width}get docWidth(){return this[kObject].doc_width}get doc_height(){return this[kObject].doc_height}get docHeight(){return this[kObject].doc_height}retrievePagesInfo(){const e=this[kObject].pages_info,t=[],r=e.page_count;for(let n=0;n<r;n++){const r=e.page(n);t.push({pageOffset:r.page_off,width:r.width_pt,height:r.height_pt})}return t}getSourceLoc(e){return this[kObject].source_span(e)}renderSvg(e){return this.plugin.renderSvg({renderSession:this,...e})}renderToSvg(e){return this.plugin.renderToSvg({renderSession:this,...e})}renderCanvas(e){return this.plugin.renderCanvas({renderSession:this,...e})}manipulateData(e){this.plugin.manipulateData({renderSession:this,...e})}renderSvgDiff(e){return this.plugin.renderSvgDiff({renderSession:this,...e})}get_source_loc(e){return this[kObject].source_span(e)}render_in_window(e,t,r,n){return this[kObject].render_in_window(e,t,r,n)}merge_delta(e){this.plugin.manipulateData({renderSession:this,action:"merge",data:e})}},gRendererModule=new LazyWasmModule((async e=>{const t=await Promise.resolve().then((()=>(init_wasm_pack_shim(),wasm_pack_shim_exports)));return await t.default(e)}));function createTypstRenderer(){return new TypstRendererDriver}function createTypstSvgRenderer(){return new TypstRendererDriver}async function rendererBuildInfo(){return(await Promise.resolve().then((()=>(init_wasm_pack_shim(),wasm_pack_shim_exports)))).renderer_build_info()}var warnOnceCanvasSet=!0,TypstRendererDriver=class{constructor(){}async init(e){this.rendererJs=await Promise.resolve().then((()=>(init_wasm_pack_shim(),wasm_pack_shim_exports)));const t=this.rendererJs.TypstRendererBuilder;this.renderer=await buildComponent(e,gRendererModule,t,{})}loadGlyphPack(e){return Promise.resolve()}createOptionsToRust(e){const t=new this.rendererJs.CreateSessionOptions;return void 0!==e.format&&(t.format=e.format),void 0!==e.artifactContent&&(t.artifact_content=e.artifactContent),t}retrievePagesInfoFromSession(e){return e.retrievePagesInfo()}renderCanvas(e){return this.withinOptionSession(e,(async t=>{const r=new this.rendererJs.RenderPageImageOptions;if(void 0!==e.pageOffset&&(r.page_off=e.pageOffset),void 0!==e.cacheKey&&(r.cache_key=e.cacheKey),void 0!==e.dataSelection){let t=0;e.dataSelection.body?t|=1:e.canvas&&warnOnceCanvasSet&&(warnOnceCanvasSet=!1,console.warn("dataSelection.body is not set but providing canvas for body")),(e.dataSelection.text||e.dataSelection.annotation)&&console.error("dataSelection.text and dataSelection.annotation are deprecated"),e.dataSelection.semantics&&(t|=8),r.data_selection=t}return this.renderer.render_page_to_canvas(t[kObject],e.canvas||void 0,r)}))}async inAnimationFrame(e){return new Promise(((t,r)=>{requestAnimationFrame((()=>{try{t(e())}catch(e){r(e)}}))}))}async renderDisplayLayer(e,t,r,n){const o=e[kObject].pages_info.page_count,i=async(t,n)=>{const o=r[t].getContext("2d");if(!o)throw new Error("canvas context is null");return await this.renderCanvas({canvas:o,renderSession:e,pageOffset:n})};return this.inAnimationFrame((async()=>{const e=performance.now(),t=(await Promise.all([(async()=>{const e=[];for(let t=0;t<o;t++)e.push(await i(t,t));return e})()]))[0],r=performance.now();return console.log(`display layer used: render = ${(r-e).toFixed(1)}ms`),t}))}renderTextLayer(e,t){const r=performance.now();e.forEach(((e,r)=>{e.innerHTML=t[r].htmlSemantics[0]}));const n=performance.now();console.log(`text layer used: render = ${(n-r).toFixed(1)}ms`)}async render(e){if("format"in e&&"vector"!==e.format&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.renderToCanvas(e)}async renderDom(e){if("format"in e&&"vector"!==e.format&&["serde_json","js","ir"].includes(e.format))throw new Error(`deprecated format ${e.format}, please use vector format`);return this.withinOptionSession(e,(async t=>{const r=new TypstDomDocument({...e,renderMode:"dom",hookedElem:e.container,kModule:t,renderer:this});return await r.impl.mountDom(e.pixelPerPt),r}))}async renderToCanvas(e){let t,r;const n=e.container;n.style.visibility="hidden";const o=async(o,i)=>{try{r=await this.renderDisplayLayer(t,n,o,e),i()}finally{n.style.visibility="visible"}};return this.withinOptionSession(e,(async i=>{if(t=i,0===t[kObject].pages_info.page_count)throw new Error("No page found in session");if(void 0!==e.pixelPerPt&&e.pixelPerPt<=0)throw new Error("Invalid typst.RenderOptions.pixelPerPt, should be a positive number "+e.pixelPerPt);let s=e.backgroundColor;if(void 0!==s&&!/^#[0-9a-f]{6}$/.test(s))throw new Error("Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ "+s);t.pixelPerPt=e.pixelPerPt??3,t.backgroundColor=s??"#ffffff";const a=performance.now(),_=new RenderView(this.retrievePagesInfoFromSession(t),n,e),c=performance.now();console.log(`layer used: retieve = ${(c-a).toFixed(1)}ms`),await o(_.canvasList,(()=>_.resetLayout())),this.renderTextLayer(_.textLayerList,r)}))}createModule(e){return Promise.resolve(new RenderSession2(this,this.renderer.create_session(e&&this.createOptionsToRust({format:"vector",artifactContent:e}))))}renderSvg(e,t){if(e instanceof RenderSession2||t)throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");return this.withinOptionSession(e,(async t=>{let r;return e.data_selection&&(r=0,e.data_selection.body&&(r|=1),e.data_selection.defs&&(r|=2),e.data_selection.css&&(r|=4),e.data_selection.js&&(r|=8)),Promise.resolve(this.renderer.svg_data(t[kObject],r))}))}renderSvgDiff(e){return e.window?this.renderer.render_svg_diff(e.renderSession[kObject],e.window.lo.x,e.window.lo.y,e.window.hi.x,e.window.hi.y):this.renderer.render_svg_diff(e.renderSession[kObject],0,0,1e33,1e33)}renderToSvg(e){return this.withinOptionSession(e,(async t=>Promise.resolve(this.renderer.render_svg(t[kObject],e.container))))}getCustomV1(e){return Promise.resolve(this.renderer.get_customs(e.renderSession[kObject]))}resetSession(e){return this.renderer.reset(e[kObject])}manipulateData(e){return this.renderer.manipulate_data(e.renderSession[kObject],e.action??"reset",e.data)}withinOptionSession(e,t){if("renderSession"in e)return t(e.renderSession);if("artifactContent"in e)return this.runWithSession(e,t);throw new Error("Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions")}async runWithSession(e,t){let r=e,n=t;t||(r=void 0,n=e);const o=this.renderer.create_session(r&&this.createOptionsToRust(r));try{const e=await n(new RenderSession2(this,o));return o.free(),e}catch(e){throw o.free(),e}}},IncrementalServer=class{constructor(e){this[kObject]=e}reset(){this[kObject].reset()}current(){return this[kObject].current()}setAttachDebugInfo(e){this[kObject].set_attach_debug_info(e)}},gCompilerModule=new LazyWasmModule((async e=>{const t=await Promise.resolve().then((()=>(init_wasm_pack_shim2(),wasm_pack_shim_exports2)));return await t.default(e)}));function createTypstCompiler(){return new TypstCompilerDriver}var TypstCompilerDriver=class{constructor(){}async init(e){this.compilerJs=await Promise.resolve().then((()=>(init_wasm_pack_shim2(),wasm_pack_shim_exports2)));const t=this.compilerJs.TypstCompilerBuilder,r={...e||{}},n=r.beforeBuild?.some((e=>void 0!==e._preloadRemoteFontOptions)),o=r.beforeBuild?.some((e=>void 0!==e._preloadRemoteFontOptions?.assets)),i=r.beforeBuild?.some((e=>!1===e._preloadRemoteFontOptions?.assets));n&&(o||i)||r.beforeBuild?.push(preloadRemoteFonts([],{assets:["text"]})),this.compiler=await buildComponent(e,gCompilerModule,t,{})}compile(e){return new Promise((t=>{t("incrementalServer"in e?this.compiler.incr_compile(e.mainFilePath,e.incrementalServer[kObject],getDiagnosticsArg(e.diagnostics)):this.compiler.compile(e.mainFilePath,e.format||"vector",getDiagnosticsArg(e.diagnostics)))}))}query(e){return new Promise((t=>{t(JSON.parse(this.compiler.query(e.mainFilePath,e.selector,e.field)))}))}getSemanticTokenLegend(){return new Promise((e=>{e(this.compiler.get_semantic_token_legend())}))}getSemanticTokens(e){return new Promise((t=>{this.compiler.reset(),t(this.compiler.get_semantic_tokens(e.offsetEncoding||"utf-16",e.mainFilePath,e.resultId))}))}async withIncrementalServer(e){const t=new IncrementalServer(this.compiler.create_incr_server());try{return await e(t)}finally{t[kObject].free()}}async getAst(e){return this.compiler.get_ast(e)}async reset(){await new Promise((e=>{this.compiler.reset(),e(void 0)}))}addSource(e,t){if(arguments.length>2)throw new Error("use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead");this.compiler.add_source(e,t)}mapShadow(e,t){this.compiler.map_shadow(e,t)}unmapShadow(e){this.compiler.unmap_shadow(e)}resetShadow(){this.compiler.reset_shadow()}renderPageToCanvas(){throw new Error("Please use the api TypstRenderer.renderToCanvas in v0.4.0")}};function getDiagnosticsArg(e){switch(e){case"none":return 1;case"unix":return 2;case"full":return 3;default:return 0}}var FetchAccessModel=class{constructor(e,t){this.root=e,this.mTimes=new Map,this.mRealPaths=new Map,this.mData=new Map,e.endsWith("/")&&(this.root=this.root.slice(0,this.root.length-1)),this.fullyCached=!!t?.fullyCached}reset(){this.mTimes.clear(),this.mRealPaths.clear(),this.mData.clear()}resolvePath(e){return this.root+e}insertFile(e,t,r){this.mTimes.set(e,r),this.mData.set(e,t)}removeFile(e){this.mTimes.delete(e),this.mData.delete(e)}async getPreloadScript(){const e=[];e.push("((async () => {"),e.push("const snapshot = {  root: '', mTimes: new Map(),  mRealPaths: new Map(),  mData: [],};"),e.push("const runFetch = async (path) => {"),e.push("  const res = await fetch(snapshot.root + path);"),e.push("  const buffer = await res.arrayBuffer();"),e.push("  return [path, new Uint8Array(buffer)];"),e.push("};"),e.push(`snapshot.root = ${JSON.stringify(this.root)};`),e.push(`snapshot.mTimes = new Map([${[...this.mTimes.entries()].map((([e,t])=>`[${JSON.stringify(e)}, ${t?.getTime()||"undefined"}]`)).join(", ")}]);`),e.push(`snapshot.mRealPaths = new Map([${[...this.mRealPaths.entries()].map((([e,t])=>`[${JSON.stringify(e)}, ${JSON.stringify(t)}]`)).join(", ")}]);`);const t=await Promise.all([...this.mData.entries()].map((async([e,t])=>(e=JSON.stringify(e),t?`runFetch(${e})`:`Promise.resolve([${e}, undefined])`))));return e.push(`snapshot.mData = await Promise.all([${t.join(", ")}]);`),e.push("return snapshot;"),e.push("})())"),e.join("\n")}getLastModified(e){const t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(null),200===t.status?t.getResponseHeader("Last-Modified"):null}getMTimeInternal(e){const t=this.getLastModified(this.resolvePath(e));if(t)return new Date(t)}getMTime(e){if(e.startsWith("/@memory/"))return this.mTimes.has(e)?this.mTimes.get(e):void 0;if(!this.fullyCached)return this.getMTimeInternal(e);if(this.mTimes.has(e))return this.mTimes.get(e);const t=this.getMTimeInternal(e);return this.mTimes.set(e,t),t}isFile(){return!0}getRealPath(e){return e}readAllInternal(e){const t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",this.resolvePath(e),!1),t.send(null),200===t.status&&(t.response instanceof String||"string"==typeof t.response))return Uint8Array.from(t.response,(e=>e.charCodeAt(0)))}readAll(e){if(e.startsWith("/@memory/"))return this.mData.has(e)?this.mData.get(e):void 0;if(!this.fullyCached)return this.readAllInternal(e);if(this.mData.has(e))return this.mData.get(e);const t=this.readAllInternal(e);return this.mData.set(e,t),t}},MemoryAccessModel=class{constructor(){this.mTimes=new Map,this.mData=new Map}reset(){this.mTimes.clear(),this.mData.clear()}insertFile(e,t,r){this.mTimes.set(e,r),this.mData.set(e,t)}removeFile(e){this.mTimes.delete(e),this.mData.delete(e)}getMTime(e){if(e.startsWith("/@memory/"))return this.mTimes.has(e)?this.mTimes.get(e):void 0}isFile(){return!0}getRealPath(e){return e}readAll(e){if(e.startsWith("/@memory/"))return this.mData.has(e)?this.mData.get(e):void 0}},FetchPackageRegistry=class{constructor(e){this.am=e,this.cache=new Map}resolvePath(e){return`https://packages.typst.org/preview/${e.name}-${e.version}.tar.gz`}pullPackageData(e){const t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",this.resolvePath(e),!1),t.send(null),200===t.status&&(t.response instanceof String||"string"==typeof t.response))return Uint8Array.from(t.response,(e=>e.charCodeAt(0)))}resolve(e,t){if("preview"!==e.namespace)return;const r=this.resolvePath(e);if(this.cache.has(r))return this.cache.get(r)();const n=this.pullPackageData(e);if(!n)return;const o=`/@memory/fetch/packages/preview/${e.namespace}/${e.name}/${e.version}`,i=[];t.untar(n,((e,t,r)=>{i.push([o+"/"+e,t,new Date(r)])}));const s=()=>{for(const[e,t,r]of i)this.am.insertFile(e,t,r);return o};return this.cache.set(r,s),s()}};window&&(window.TypstRenderModule={RenderView:RenderView,createTypstRenderer:createTypstRenderer,createTypstSvgRenderer:createTypstRenderer,preloadRemoteFonts:preloadRemoteFonts,preloadSystemFonts:preloadSystemFonts},window.TypstCompileModule={createTypstCompiler:createTypstCompiler,preloadRemoteFonts:preloadRemoteFonts,preloadSystemFonts:preloadSystemFonts,FetchAccessModel:FetchAccessModel,MemoryAccessModel:MemoryAccessModel,FetchPackageRegistry:FetchPackageRegistry,withAccessModel:withAccessModel,withPackageRegistry:withPackageRegistry});export{FetchAccessModel,FetchPackageRegistry,createTypstCompiler,createTypstRenderer,createTypstSvgRenderer,preloadRemoteFonts,preloadSystemFonts,rendererBuildInfo};